<!DOCTYPE html>
<html>
  <!-- meta/link... -->
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <title>Netty Âü∫Á°Ä | ÈÇ¢Êô®Êó≠ÁöÑÂçöÂÆ¢</title>

  <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

  
    <script>
        var themeModelId = '2';
        if (themeModelId) {
            localStorage.setItem('modelId', themeModelId);
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/gh/yuang01/live2d-widget@latest/autoload.js"></script>
    <script>
        var live2dOpen = eval('true') || false;
        if (!live2dOpen) {
            localStorage.setItem('waifu-display', 1609323474481);
        }
    </script>
  
  
  
<link rel="stylesheet" href="/css/animate.min.css">

  
<link rel="stylesheet" href="/css/style.css">

  
  
    
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/js/shareJs/share.min.css">

  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

    

    <!-- import link -->
    
        
            
        
            
        
    
    <!-- import script -->
    
        
            
        
            
        
    

<meta name="generator" content="Hexo 5.4.0"></head>

  
  <!-- ‰æùËµñ‰∫éjqueryÂíåvue -->
  <script src="/js/jquery3.5.1.js"></script>
  <script src="/js/vue2.6.11.js"></script>
  
  <body>
    <!-- È¢ÑÂä†ËΩΩÂä®Áîª -->
    <!-- È°µÈù¢È¢ÑÂä†ËΩΩÂä®Áîª -->

<div id='loader'>
  <link rel="stylesheet" href="/js/loaded/index.css" >
  <div class="loading-left-bg"></div>
  <div class="loading-right-bg"></div>
  <div class="spinner-box">
    <div class="configure-border-1">
      <div class="configure-core"></div>
    </div>
    <div class="configure-border-2">
      <div class="configure-core"></div>
    </div>
    <div class="loading-word">Âä†ËΩΩ‰∏≠...</div>
  </div>
</div>

<script>
  var endLoading = function () {
    document.body.style.overflow = 'auto';
    document.getElementById('loader').classList.add("loading");
  }
  window.addEventListener('DOMContentLoaded',endLoading);
  
</script>

    
    <!-- Âà§Êñ≠ÊòØÂê¶‰∏∫ÊöóÈªëÈ£éÊ†º -->
    <!-- Âà§Êñ≠ÊòØÂê¶‰∏∫ÈªëÂ§úÊ®°Âºè -->
<script>
  let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }
</script>

    <!-- Â§¥ÈÉ®ÂØºËà™Á≠â -->
    
<header class="header " id="navHeader"
  style="position: fixed;
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <div class="drawer-box-icon">
    <i class="fa fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  </div>
  
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo" src="https://sh-xcx-blog.oss-cn-shanghai.aliyuncs.com/user/avatar/avatar.jpg" alt="logo">
      <h3 class="drawer-box-head_title">ÈÇ¢Êô®Êó≠ÁöÑÂçöÂÆ¢</h3>
      <h5 class="drawer-box-head_desc">ÈÇ¢Êô®Êó≠ÁöÑÂçöÂÆ¢</h5>
    </div>
    
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/" class="drawer-menu-item-link">
                  
                    <i class="fa fa-home" aria-hidden="true"></i>
                  
                  <span class="name">È¶ñÈ°µ</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/archives" class="drawer-menu-item-link">
                  
                    <i class="fa fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">ÂΩíÊ°£</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/tags" class="drawer-menu-item-link">
                  
                    <i class="fa fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">Ê†áÁ≠æ</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/categories" class="drawer-menu-item-link">
                  
                    <i class="fa fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">ÂàÜÁ±ª</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/friends" class="drawer-menu-item-link">
                  
                    <i class="fa fa-handshake-o" aria-hidden="true"></i>
                  
                  <span class="name">ÂèãÊÉÖÈìæÊé•</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/about" class="drawer-menu-item-link">
                  
                    <i class="fa fa-user" aria-hidden="true"></i>
                  
                  <span class="name">ÂÖ≥‰∫é</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="javascript:;" class="drawer-menu-item-link has-children" @click="openOrCloseMenu(6)">
                  <span>
                    
                      <i class="fa fa-link"></i>
                    
                    <span class="name">Other</span>
                  </span>
                  <i class="fa fa-chevron-left arrow " :class="{'icon-rotate': isOpen(6)}" aria-hidden="true"></i>
                </a>
                <ul class="drawer-sub-menu" v-if="isOpen(6)">
                  
                  <li>
                    <a href="/gallery">
                      
                      <i class="fa fa-music" style="margin-top: -20px;"></i>
                      
                      <span>üíØÂõæÂ∫ì</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/me">
                      
                      <i class="fa fa-film" style="margin-top: -20px;"></i>
                      
                      <span>üêáÂÖ≥‰∫éÊàë</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
        
          <li class="drawer-box-content_item">
            <a target="_blank" rel="noopener" href="https://github.com/xingchenxuup">
              <i class="fa fa-github" aria-hidden="true"></i>
              <span>Github</span>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // Èò≤Ê≠¢È°µÈù¢ÊªöÂä®ÔºåÂè™ËÉΩËÆ©ÂºπÊ°ÜÊªöÂä®
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>

    </div>
    <div class="blog-title" id="author-avatar">
      
        <div class="avatar">
          <img src="https://sh-xcx-blog.oss-cn-shanghai.aliyuncs.com/user/avatar/avatar.jpg" alt="logo">
        </div>
      
      <a href="/" class="logo">ÈÇ¢Êô®Êó≠ÁöÑÂçöÂÆ¢</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/" class="menu-item-link" title="È¶ñÈ°µ">
                  
                    <i class="fa fa-home" aria-hidden="true"></i>
                  
                  <span class="name">È¶ñÈ°µ</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/archives" class="menu-item-link" title="ÂΩíÊ°£">
                  
                    <i class="fa fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">ÂΩíÊ°£</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/tags" class="menu-item-link" title="Ê†áÁ≠æ">
                  
                    <i class="fa fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">Ê†áÁ≠æ</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/categories" class="menu-item-link" title="ÂàÜÁ±ª">
                  
                    <i class="fa fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">ÂàÜÁ±ª</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/friends" class="menu-item-link" title="ÂèãÊÉÖÈìæÊé•">
                  
                    <i class="fa fa-handshake-o" aria-hidden="true"></i>
                  
                  <span class="name">ÂèãÊÉÖÈìæÊé•</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/about" class="menu-item-link" title="ÂÖ≥‰∫é">
                  
                    <i class="fa fa-user" aria-hidden="true"></i>
                  
                  <span class="name">ÂÖ≥‰∫é</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="javascript:;" class="menu-item-link" title="Other">
                  
                    <i class="fa fa-link"></i>
                  
                  <span class="name">Other</span>
                  <i class="fa fa-chevron-down arrow" aria-hidden="true"></i>
                </a>
                <ul class="sub-menu">
                  
                  <li>
                    <a href="/gallery">
                      
                      <i class="fa fa-music" style="margin-top: -20px;"></i>
                      
                      <span>üíØÂõæÂ∫ì</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/me">
                      
                      <i class="fa fa-film" style="margin-top: -20px;"></i>
                      
                      <span>üêáÂÖ≥‰∫éÊàë</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
      </ul>
      
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fa fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <!-- <div class="close" style="overflow: hidden;">
          <i class="fa fa-close" aria-hidden="true" style="float:right;" @click.self="cancelDialogVisible()"></i>
        </div> -->
        <h2>
          <span>
            <i class="fa fa-search" aria-hidden="true"></i>
            <span class="title">Êú¨Âú∞ÊêúÁ¥¢</span>
          </span>
          <i class="fa fa-close close" pointer style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i>
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="ËØ∑ËæìÂÖ•ÂÖ≥ÈîÆÂ≠ó"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="/js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // Èò≤Ê≠¢È°µÈù¢ÊªöÂä®ÔºåÂè™ËÉΩËÆ©ÂºπÊ°ÜÊªöÂä®
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("/search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- Ëß£ÂÜ≥Âà∑Êñ∞È°µÈù¢Èó™ÁÉÅÈóÆÈ¢òÔºåÂèØ‰ª•Âú®ÂÖÉÁ¥†‰∏äÊ∑ªÂä†display: none, ÊàñËÄÖÁî®vue.extendÊñπÊ≥ïÔºåËØ¶ÊÉÖÔºöhttps://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- ‰∏ãÈù¢ÊòØÊêúÁ¥¢Âü∫Êú¨ÂÜôÊ≥ï -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
    <a target="_blank" rel="noopener" href="https://github.com/xingchenxuup" class="github-corner color-primary" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  
  
    <div id="he-plugin-simple"></div>
    <script>
      WIDGET = {
        CONFIG: {
          "modules": "012",
          "background": 5,
          "tmpColor": "4A4A4A",
          "tmpSize": 16,
          "cityColor": "4A4A4A",
          "citySize": 16,
          "aqiSize": 16,
          "weatherIconSize": 24,
          "alertIconSize": 18,
          "padding": "10px 10px 10px 10px",
          "shadow": "1",
          "language": "auto",
          "borderRadius": 5,
          "fixed": "false",
          "vertical": "middle",
          "horizontal": "center",
          "key": "2784dd3fcb1e4f0f9a9b579bf69641f2"
        }
      }
    </script>
    <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script> 
    

    <!-- ÂΩìÂ§¥ÈÉ®ÂØºËà™ËÆæÁΩÆ‰∏∫ËÉåÊôØÈÄèÊòéÁöÑÊó∂ÂÄô  -->
    
      <script src="/js/header/index.js" data-pjax></script>
    
</header>

    <!-- ÈúÄË¶ÅÂú®‰∏äÈù¢Âä†ËΩΩÁöÑjs -->
    <script>
    function loadScript(src, cb) {
        setTimeout(function () {
            var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
            var script = document.createElement('script');
            script.setAttribute('type', 'text/javascript');
            if (cb) script.onload = cb;
            script.setAttribute('src', src);
            HEAD.appendChild(script);
        });
    }

    //https://github.com/filamentgroup/loadCSS
    var loadCSS = function (href, before, media, attributes) {
        var doc = window.document;
        var ss = doc.createElement("link");
        var ref;
        if (before) {
            ref = before;
        }
        else {
            var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
            ref = refs[refs.length - 1];
        }
        var sheets = doc.styleSheets;
        if (attributes) {
            for (var attributeName in attributes) {
                if (attributes.hasOwnProperty(attributeName)) {
                    ss.setAttribute(attributeName, attributes[attributeName]);
                }
            }
        }
        ss.rel = "stylesheet";
        ss.href = href;
        ss.media = "only x";
        function ready(cb) {
            if (doc.body) {
                return cb();
            }
            setTimeout(function () {
                ready(cb);
            });
        }
        ready(function () {
            ref.parentNode.insertBefore(ss, (before ? ref : ref.nextSibling));
        });
        var onloadcssdefined = function (cb) {
            var resolvedHref = ss.href;
            var i = sheets.length;
            while (i--) {
                if (sheets[i].href === resolvedHref) {
                    return cb();
                }
            }
            setTimeout(function () {
                onloadcssdefined(cb);
            });
        };
        function loadCB() {
            if (ss.addEventListener) {
                ss.removeEventListener("load", loadCB);
            }
            ss.media = media || "all";
        }
        if (ss.addEventListener) {
            ss.addEventListener("load", loadCB);
        }
        ss.onloadcssdefined = onloadcssdefined;
        onloadcssdefined(loadCB);
        return ss;
    };
    
</script>
 

<!-- ËΩÆÊí≠ÂõæÊâÄÈúÄË¶ÅÁöÑjs -->
<script src="/js/swiper/swiper.min.js"></script>
<script src="/js/swiper/vue-awesome-swiper.js"></script>
<script src="/js/swiper/swiper.animate1.0.3.min.js"></script>


  <script src="/js/vue-typed-js/index.js"></script>


<!-- È¶ñÈ°µÁöÑÂÖ¨ÂëäÊªöÂä®Êèí‰ª∂ÁöÑjsÈúÄË¶ÅÈáçÊñ∞Âä†ËΩΩ -->
<script src="/js/vue-seamless-scroll/index.js"></script>

<!-- ÊâìÂ≠óÊú∫ÊïàÊûújs -->
<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>


    <!-- ÂÜÖÂÆπÂå∫Âüü -->
    <div id="safearea">
      <main class="main" id="pjax-container" style="margin-top: 0;">
        
 <!-- prismjs ‰ª£Á†ÅÈ´ò‰∫Æ -->
 


<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>

<!-- ÊñáÁ´†ËØ¶ÊÉÖÈ°µÈ°∂ÈÉ®ÂõæÁâáÂíåÊ†áÈ¢ò -->




<div class="post-detail-header lazyload" id="thumbnail_canvas" data-original="/medias/10.jpg" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0;pointer-events:none;"></canvas>
  
  <div class="post-detail-header_info-box">
    <div class="title-box">
      <span class="title">
        Netty Âü∫Á°Ä
      </span>
    </div>
    
    
      
        <span class="post-detail-header_date">
          <i class="fa fa-calendar"></i> ÂèëË°®‰∫éÔºö2021-09-22 |
        </span>
      

      
        <span class="post-detail-header_categories">
          <i class="iconfont iconbookmark1"></i> ÂàÜÁ±ªÔºö
          
            <a href="/categories/Netty/" class="post-detail-header_category">
              Netty
            </a>
          
            <a href="/categories/Netty/Java/" class="post-detail-header_category">
              Java
            </a>
          
            <a href="/categories/Netty/Java/NIO/" class="post-detail-header_category">
              NIO
            </a>
          
        </span>
      

      
    
  </div>
  
  
    <script src="/js/bubble/bubble.js"></script>
  
</div>



<div class="row justify-position">
  <div class="main-content">
    <article class="post post-detail">
      
      <div class="post-content">
        <h1 id="‰∏Ä-NIO-Âü∫Á°Ä"><a href="#‰∏Ä-NIO-Âü∫Á°Ä" class="headerlink" title="‰∏Ä. NIO Âü∫Á°Ä"></a>‰∏Ä. NIO Âü∫Á°Ä</h1><p>non-blocking io ÈùûÈòªÂ°û IO</p>
<h2 id="1-‰∏âÂ§ßÁªÑ‰ª∂"><a href="#1-‰∏âÂ§ßÁªÑ‰ª∂" class="headerlink" title="1. ‰∏âÂ§ßÁªÑ‰ª∂"></a>1. ‰∏âÂ§ßÁªÑ‰ª∂</h2><h3 id="1-1-Channel-amp-Buffer"><a href="#1-1-Channel-amp-Buffer" class="headerlink" title="1.1 Channel &amp; Buffer"></a>1.1 Channel &amp; Buffer</h3><p>channel Êúâ‰∏ÄÁÇπÁ±ª‰ºº‰∫é streamÔºåÂÆÉÂ∞±ÊòØËØªÂÜôÊï∞ÊçÆÁöÑ<strong>ÂèåÂêëÈÄöÈÅì</strong>ÔºåÂèØ‰ª•‰ªé channel Â∞ÜÊï∞ÊçÆËØªÂÖ• bufferÔºå‰πüÂèØ‰ª•Â∞Ü buffer ÁöÑÊï∞ÊçÆÂÜôÂÖ• channelÔºåËÄå‰πãÂâçÁöÑ stream Ë¶Å‰πàÊòØËæìÂÖ•ÔºåË¶Å‰πàÊòØËæìÂá∫Ôºåchannel ÊØî stream Êõ¥‰∏∫Â∫ïÂ±Ç</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">channel --&gt; buffer</span><br><span class="line">buffer --&gt; channel</span><br></pre></td></tr></table></figure>

<p>Â∏∏ËßÅÁöÑ Channel Êúâ</p>
<ul>
<li>FileChannel</li>
<li>DatagramChannel</li>
<li>SocketChannel</li>
<li>ServerSocketChannel</li>
</ul>
<p>buffer ÂàôÁî®Êù•ÁºìÂÜ≤ËØªÂÜôÊï∞ÊçÆÔºåÂ∏∏ËßÅÁöÑ buffer Êúâ</p>
<ul>
<li>ByteBuffer<ul>
<li>MappedByteBuffer</li>
<li>DirectByteBuffer</li>
<li>HeapByteBuffer</li>
</ul>
</li>
<li>ShortBuffer</li>
<li>IntBuffer</li>
<li>LongBuffer</li>
<li>FloatBuffer</li>
<li>DoubleBuffer</li>
<li>CharBuffer</li>
</ul>
<h3 id="1-2-Selector"><a href="#1-2-Selector" class="headerlink" title="1.2 Selector"></a>1.2 Selector</h3><p>selector Âçï‰ªéÂ≠óÈù¢ÊÑèÊÄù‰∏çÂ•ΩÁêÜËß£ÔºåÈúÄË¶ÅÁªìÂêàÊúçÂä°Âô®ÁöÑËÆæËÆ°ÊºîÂåñÊù•ÁêÜËß£ÂÆÉÁöÑÁî®ÈÄî</p>
<h4 id="Â§öÁ∫øÁ®ãÁâàËÆæËÆ°"><a href="#Â§öÁ∫øÁ®ãÁâàËÆæËÆ°" class="headerlink" title="Â§öÁ∫øÁ®ãÁâàËÆæËÆ°"></a>Â§öÁ∫øÁ®ãÁâàËÆæËÆ°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">subgraph Â§öÁ∫øÁ®ãÁâà</span><br><span class="line">t1(thread) --&gt; s1(socket1)</span><br><span class="line">t2(thread) --&gt; s2(socket2)</span><br><span class="line">t3(thread) --&gt; s3(socket3)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h4 id="‚ö†Ô∏è-Â§öÁ∫øÁ®ãÁâàÁº∫ÁÇπ"><a href="#‚ö†Ô∏è-Â§öÁ∫øÁ®ãÁâàÁº∫ÁÇπ" class="headerlink" title="‚ö†Ô∏è Â§öÁ∫øÁ®ãÁâàÁº∫ÁÇπ"></a>‚ö†Ô∏è Â§öÁ∫øÁ®ãÁâàÁº∫ÁÇπ</h4><ul>
<li>ÂÜÖÂ≠òÂç†Áî®È´ò</li>
<li>Á∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢ÊàêÊú¨È´ò</li>
<li>Âè™ÈÄÇÂêàËøûÊé•Êï∞Â∞ëÁöÑÂú∫ÊôØ</li>
</ul>
<h4 id="Á∫øÁ®ãÊ±†ÁâàËÆæËÆ°"><a href="#Á∫øÁ®ãÊ±†ÁâàËÆæËÆ°" class="headerlink" title="Á∫øÁ®ãÊ±†ÁâàËÆæËÆ°"></a>Á∫øÁ®ãÊ±†ÁâàËÆæËÆ°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">subgraph Á∫øÁ®ãÊ±†Áâà</span><br><span class="line">t4(thread) --&gt; s4(socket1)</span><br><span class="line">t5(thread) --&gt; s5(socket2)</span><br><span class="line">t4(thread) -.-&gt; s6(socket3)</span><br><span class="line">t5(thread) -.-&gt; s7(socket4)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h4 id="‚ö†Ô∏è-Á∫øÁ®ãÊ±†ÁâàÁº∫ÁÇπ"><a href="#‚ö†Ô∏è-Á∫øÁ®ãÊ±†ÁâàÁº∫ÁÇπ" class="headerlink" title="‚ö†Ô∏è Á∫øÁ®ãÊ±†ÁâàÁº∫ÁÇπ"></a>‚ö†Ô∏è Á∫øÁ®ãÊ±†ÁâàÁº∫ÁÇπ</h4><ul>
<li>ÈòªÂ°ûÊ®°Âºè‰∏ãÔºåÁ∫øÁ®ã‰ªÖËÉΩÂ§ÑÁêÜ‰∏Ä‰∏™ socket ËøûÊé•</li>
<li>‰ªÖÈÄÇÂêàÁü≠ËøûÊé•Âú∫ÊôØ</li>
</ul>
<h4 id="selector-ÁâàËÆæËÆ°"><a href="#selector-ÁâàËÆæËÆ°" class="headerlink" title="selector ÁâàËÆæËÆ°"></a>selector ÁâàËÆæËÆ°</h4><p>selector ÁöÑ‰ΩúÁî®Â∞±ÊòØÈÖçÂêà‰∏Ä‰∏™Á∫øÁ®ãÊù•ÁÆ°ÁêÜÂ§ö‰∏™ channelÔºåËé∑ÂèñËøô‰∫õ channel ‰∏äÂèëÁîüÁöÑ‰∫ã‰ª∂ÔºåËøô‰∫õ channel Â∑•‰ΩúÂú®ÈùûÈòªÂ°ûÊ®°Âºè‰∏ãÔºå‰∏ç‰ºöËÆ©Á∫øÁ®ãÂêäÊ≠ªÂú®‰∏Ä‰∏™ channel ‰∏ä„ÄÇÈÄÇÂêàËøûÊé•Êï∞ÁâπÂà´Â§öÔºå‰ΩÜÊµÅÈáè‰ΩéÁöÑÂú∫ÊôØÔºàlow trafficÔºâ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">subgraph selector Áâà</span><br><span class="line">thread --&gt; selector</span><br><span class="line">selector --&gt; c1(channel)</span><br><span class="line">selector --&gt; c2(channel)</span><br><span class="line">selector --&gt; c3(channel)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>



<p>Ë∞ÉÁî® selector ÁöÑ select() ‰ºöÈòªÂ°ûÁõ¥Âà∞ channel ÂèëÁîü‰∫ÜËØªÂÜôÂ∞±Áª™‰∫ã‰ª∂ÔºåËøô‰∫õ‰∫ã‰ª∂ÂèëÁîüÔºåselect ÊñπÊ≥ïÂ∞±‰ºöËøîÂõûËøô‰∫õ‰∫ã‰ª∂‰∫§Áªô thread Êù•Â§ÑÁêÜ</p>
<h2 id="2-ByteBuffer"><a href="#2-ByteBuffer" class="headerlink" title="2. ByteBuffer"></a>2. ByteBuffer</h2><p>Êúâ‰∏ÄÊôÆÈÄöÊñáÊú¨Êñá‰ª∂ data.txtÔºåÂÜÖÂÆπ‰∏∫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1234567890abcd</span><br></pre></td></tr></table></figure>

<p>‰ΩøÁî® FileChannel Êù•ËØªÂèñÊñá‰ª∂ÂÜÖÂÆπ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChannelDemo1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (RandomAccessFile file = <span class="keyword">new</span> RandomAccessFile(<span class="string">&quot;helloword/data.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>)) &#123;</span><br><span class="line">            FileChannel channel = file.getChannel();</span><br><span class="line">            ByteBuffer buffer = ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="comment">// Âêë buffer ÂÜôÂÖ•</span></span><br><span class="line">                <span class="keyword">int</span> len = channel.read(buffer);</span><br><span class="line">                log.debug(<span class="string">&quot;ËØªÂà∞Â≠óËäÇÊï∞Ôºö&#123;&#125;&quot;</span>, len);</span><br><span class="line">                <span class="keyword">if</span> (len == -<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ÂàáÊç¢ buffer ËØªÊ®°Âºè</span></span><br><span class="line">                buffer.flip();</span><br><span class="line">                <span class="keyword">while</span>(buffer.hasRemaining()) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;&#123;&#125;&quot;</span>, (<span class="keyword">char</span>)buffer.get());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ÂàáÊç¢ buffer ÂÜôÊ®°Âºè</span></span><br><span class="line">                buffer.clear();</span><br><span class="line">            &#125; <span class="keyword">while</span> (<span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ËæìÂá∫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - ËØªÂà∞Â≠óËäÇÊï∞Ôºö10</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 1</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 2</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 3</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 4</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 5</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 6</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 7</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 8</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 9</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 0</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - ËØªÂà∞Â≠óËäÇÊï∞Ôºö4</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - a</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - b</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - c</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - d</span><br><span class="line">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - ËØªÂà∞Â≠óËäÇÊï∞Ôºö-1</span><br></pre></td></tr></table></figure>



<h3 id="2-1-ByteBuffer-Ê≠£Á°Æ‰ΩøÁî®ÂßøÂäø"><a href="#2-1-ByteBuffer-Ê≠£Á°Æ‰ΩøÁî®ÂßøÂäø" class="headerlink" title="2.1  ByteBuffer Ê≠£Á°Æ‰ΩøÁî®ÂßøÂäø"></a>2.1  ByteBuffer Ê≠£Á°Æ‰ΩøÁî®ÂßøÂäø</h3><ol>
<li>Âêë buffer ÂÜôÂÖ•Êï∞ÊçÆÔºå‰æãÂ¶ÇË∞ÉÁî® channel.read(buffer)</li>
<li>Ë∞ÉÁî® flip() ÂàáÊç¢Ëá≥<strong>ËØªÊ®°Âºè</strong></li>
<li>‰ªé buffer ËØªÂèñÊï∞ÊçÆÔºå‰æãÂ¶ÇË∞ÉÁî® buffer.get()</li>
<li>Ë∞ÉÁî® clear() Êàñ compact() ÂàáÊç¢Ëá≥<strong>ÂÜôÊ®°Âºè</strong></li>
<li>ÈáçÂ§ç 1~4 Ê≠•È™§</li>
</ol>
<h3 id="2-2-ByteBuffer-ÁªìÊûÑ"><a href="#2-2-ByteBuffer-ÁªìÊûÑ" class="headerlink" title="2.2 ByteBuffer ÁªìÊûÑ"></a>2.2 ByteBuffer ÁªìÊûÑ</h3><p>ByteBuffer Êúâ‰ª•‰∏ãÈáçË¶ÅÂ±ûÊÄß</p>
<ul>
<li>capacity</li>
<li>position</li>
<li>limit</li>
</ul>
<p>‰∏ÄÂºÄÂßã</p>
<p><img "" class="lazyload placeholder" data-original="img/0021.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<p>ÂÜôÊ®°Âºè‰∏ãÔºåposition ÊòØÂÜôÂÖ•‰ΩçÁΩÆÔºålimit Á≠â‰∫éÂÆπÈáèÔºå‰∏ãÂõæË°®Á§∫ÂÜôÂÖ•‰∫Ü 4 ‰∏™Â≠óËäÇÂêéÁöÑÁä∂ÊÄÅ</p>
<p><img "" class="lazyload placeholder" data-original="img/0018.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<p>flip Âä®‰ΩúÂèëÁîüÂêéÔºåposition ÂàáÊç¢‰∏∫ËØªÂèñ‰ΩçÁΩÆÔºålimit ÂàáÊç¢‰∏∫ËØªÂèñÈôêÂà∂</p>
<p><img "" class="lazyload placeholder" data-original="img/0019.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<p>ËØªÂèñ 4 ‰∏™Â≠óËäÇÂêéÔºåÁä∂ÊÄÅ</p>
<p><img "" class="lazyload placeholder" data-original="img/0020.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<p>clear Âä®‰ΩúÂèëÁîüÂêéÔºåÁä∂ÊÄÅ</p>
<p><img "" class="lazyload placeholder" data-original="img/0021.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<p>compact ÊñπÊ≥ïÔºåÊòØÊääÊú™ËØªÂÆåÁöÑÈÉ®ÂàÜÂêëÂâçÂéãÁº©ÔºåÁÑ∂ÂêéÂàáÊç¢Ëá≥ÂÜôÊ®°Âºè</p>
<p><img "" class="lazyload placeholder" data-original="img/0022.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<h4 id="üí°-Ë∞ÉËØïÂ∑•ÂÖ∑Á±ª"><a href="#üí°-Ë∞ÉËØïÂ∑•ÂÖ∑Á±ª" class="headerlink" title="üí° Ë∞ÉËØïÂ∑•ÂÖ∑Á±ª"></a>üí° Ë∞ÉËØïÂ∑•ÂÖ∑Á±ª</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ByteBufferUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] BYTE2CHAR = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] HEXDUMP_TABLE = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">256</span> * <span class="number">4</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] HEXPADDING = <span class="keyword">new</span> String[<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] HEXDUMP_ROWPREFIXES = <span class="keyword">new</span> String[<span class="number">65536</span> &gt;&gt;&gt; <span class="number">4</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] BYTE2HEX = <span class="keyword">new</span> String[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] BYTEPADDING = <span class="keyword">new</span> String[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">char</span>[] DIGITS = <span class="string">&quot;0123456789abcdef&quot;</span>.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">            HEXDUMP_TABLE[i &lt;&lt; <span class="number">1</span>] = DIGITS[i &gt;&gt;&gt; <span class="number">4</span> &amp; <span class="number">0x0F</span>];</span><br><span class="line">            HEXDUMP_TABLE[(i &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>] = DIGITS[i &amp; <span class="number">0x0F</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Generate the lookup table for hex dump paddings</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; HEXPADDING.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> padding = HEXPADDING.length - i;</span><br><span class="line">            StringBuilder buf = <span class="keyword">new</span> StringBuilder(padding * <span class="number">3</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; padding; j++) &#123;</span><br><span class="line">                buf.append(<span class="string">&quot;   &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            HEXPADDING[i] = buf.toString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Generate the lookup table for the start-offset header in each row (up to 64KiB).</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; HEXDUMP_ROWPREFIXES.length; i++) &#123;</span><br><span class="line">            StringBuilder buf = <span class="keyword">new</span> StringBuilder(<span class="number">12</span>);</span><br><span class="line">            buf.append(NEWLINE);</span><br><span class="line">            buf.append(Long.toHexString(i &lt;&lt; <span class="number">4</span> &amp; <span class="number">0xFFFFFFFFL</span> | <span class="number">0x100000000L</span>));</span><br><span class="line">            buf.setCharAt(buf.length() - <span class="number">9</span>, <span class="string">&#x27;|&#x27;</span>);</span><br><span class="line">            buf.append(<span class="string">&#x27;|&#x27;</span>);</span><br><span class="line">            HEXDUMP_ROWPREFIXES[i] = buf.toString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Generate the lookup table for byte-to-hex-dump conversion</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; BYTE2HEX.length; i++) &#123;</span><br><span class="line">            BYTE2HEX[i] = <span class="string">&#x27; &#x27;</span> + StringUtil.byteToHexStringPadded(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Generate the lookup table for byte dump paddings</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; BYTEPADDING.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> padding = BYTEPADDING.length - i;</span><br><span class="line">            StringBuilder buf = <span class="keyword">new</span> StringBuilder(padding);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; padding; j++) &#123;</span><br><span class="line">                buf.append(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            BYTEPADDING[i] = buf.toString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Generate the lookup table for byte-to-char conversion</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; BYTE2CHAR.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &lt;= <span class="number">0x1f</span> || i &gt;= <span class="number">0x7f</span>) &#123;</span><br><span class="line">                BYTE2CHAR[i] = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                BYTE2CHAR[i] = (<span class="keyword">char</span>) i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ÊâìÂç∞ÊâÄÊúâÂÜÖÂÆπ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> buffer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">debugAll</span><span class="params">(ByteBuffer buffer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> oldlimit = buffer.limit();</span><br><span class="line">        buffer.limit(buffer.capacity());</span><br><span class="line">        StringBuilder origin = <span class="keyword">new</span> StringBuilder(<span class="number">256</span>);</span><br><span class="line">        appendPrettyHexDump(origin, buffer, <span class="number">0</span>, buffer.capacity());</span><br><span class="line">        System.out.println(<span class="string">&quot;+--------+-------------------- all ------------------------+----------------+&quot;</span>);</span><br><span class="line">        System.out.printf(<span class="string">&quot;position: [%d], limit: [%d]\n&quot;</span>, buffer.position(), oldlimit);</span><br><span class="line">        System.out.println(origin);</span><br><span class="line">        buffer.limit(oldlimit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ÊâìÂç∞ÂèØËØªÂèñÂÜÖÂÆπ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> buffer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">debugRead</span><span class="params">(ByteBuffer buffer)</span> </span>&#123;</span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder(<span class="number">256</span>);</span><br><span class="line">        appendPrettyHexDump(builder, buffer, buffer.position(), buffer.limit() - buffer.position());</span><br><span class="line">        System.out.println(<span class="string">&quot;+--------+-------------------- read -----------------------+----------------+&quot;</span>);</span><br><span class="line">        System.out.printf(<span class="string">&quot;position: [%d], limit: [%d]\n&quot;</span>, buffer.position(), buffer.limit());</span><br><span class="line">        System.out.println(builder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">appendPrettyHexDump</span><span class="params">(StringBuilder dump, ByteBuffer buf, <span class="keyword">int</span> offset, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isOutOfBounds(offset, length, buf.capacity())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(</span><br><span class="line">                    <span class="string">&quot;expected: &quot;</span> + <span class="string">&quot;0 &lt;= offset(&quot;</span> + offset + <span class="string">&quot;) &lt;= offset + length(&quot;</span> + length</span><br><span class="line">                            + <span class="string">&quot;) &lt;= &quot;</span> + <span class="string">&quot;buf.capacity(&quot;</span> + buf.capacity() + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        dump.append(</span><br><span class="line">                <span class="string">&quot;         +-------------------------------------------------+&quot;</span> +</span><br><span class="line">                        NEWLINE + <span class="string">&quot;         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |&quot;</span> +</span><br><span class="line">                        NEWLINE + <span class="string">&quot;+--------+-------------------------------------------------+----------------+&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> startIndex = offset;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> fullRows = length &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> remainder = length &amp; <span class="number">0xF</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dump the rows which have 16 bytes.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> row = <span class="number">0</span>; row &lt; fullRows; row++) &#123;</span><br><span class="line">            <span class="keyword">int</span> rowStartIndex = (row &lt;&lt; <span class="number">4</span>) + startIndex;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Per-row prefix.</span></span><br><span class="line">            appendHexDumpRowPrefix(dump, row, rowStartIndex);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Hex dump</span></span><br><span class="line">            <span class="keyword">int</span> rowEndIndex = rowStartIndex + <span class="number">16</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = rowStartIndex; j &lt; rowEndIndex; j++) &#123;</span><br><span class="line">                dump.append(BYTE2HEX[getUnsignedByte(buf, j)]);</span><br><span class="line">            &#125;</span><br><span class="line">            dump.append(<span class="string">&quot; |&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ASCII dump</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = rowStartIndex; j &lt; rowEndIndex; j++) &#123;</span><br><span class="line">                dump.append(BYTE2CHAR[getUnsignedByte(buf, j)]);</span><br><span class="line">            &#125;</span><br><span class="line">            dump.append(<span class="string">&#x27;|&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dump the last row which has less than 16 bytes.</span></span><br><span class="line">        <span class="keyword">if</span> (remainder != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> rowStartIndex = (fullRows &lt;&lt; <span class="number">4</span>) + startIndex;</span><br><span class="line">            appendHexDumpRowPrefix(dump, fullRows, rowStartIndex);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Hex dump</span></span><br><span class="line">            <span class="keyword">int</span> rowEndIndex = rowStartIndex + remainder;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = rowStartIndex; j &lt; rowEndIndex; j++) &#123;</span><br><span class="line">                dump.append(BYTE2HEX[getUnsignedByte(buf, j)]);</span><br><span class="line">            &#125;</span><br><span class="line">            dump.append(HEXPADDING[remainder]);</span><br><span class="line">            dump.append(<span class="string">&quot; |&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Ascii dump</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = rowStartIndex; j &lt; rowEndIndex; j++) &#123;</span><br><span class="line">                dump.append(BYTE2CHAR[getUnsignedByte(buf, j)]);</span><br><span class="line">            &#125;</span><br><span class="line">            dump.append(BYTEPADDING[remainder]);</span><br><span class="line">            dump.append(<span class="string">&#x27;|&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        dump.append(NEWLINE +</span><br><span class="line">                <span class="string">&quot;+--------+-------------------------------------------------+----------------+&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">appendHexDumpRowPrefix</span><span class="params">(StringBuilder dump, <span class="keyword">int</span> row, <span class="keyword">int</span> rowStartIndex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (row &lt; HEXDUMP_ROWPREFIXES.length) &#123;</span><br><span class="line">            dump.append(HEXDUMP_ROWPREFIXES[row]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dump.append(NEWLINE);</span><br><span class="line">            dump.append(Long.toHexString(rowStartIndex &amp; <span class="number">0xFFFFFFFFL</span> | <span class="number">0x100000000L</span>));</span><br><span class="line">            dump.setCharAt(dump.length() - <span class="number">9</span>, <span class="string">&#x27;|&#x27;</span>);</span><br><span class="line">            dump.append(<span class="string">&#x27;|&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">short</span> <span class="title">getUnsignedByte</span><span class="params">(ByteBuffer buffer, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">short</span>) (buffer.get(index) &amp; <span class="number">0xFF</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-3-ByteBuffer-Â∏∏ËßÅÊñπÊ≥ï"><a href="#2-3-ByteBuffer-Â∏∏ËßÅÊñπÊ≥ï" class="headerlink" title="2.3 ByteBuffer Â∏∏ËßÅÊñπÊ≥ï"></a>2.3 ByteBuffer Â∏∏ËßÅÊñπÊ≥ï</h3><h4 id="ÂàÜÈÖçÁ©∫Èó¥"><a href="#ÂàÜÈÖçÁ©∫Èó¥" class="headerlink" title="ÂàÜÈÖçÁ©∫Èó¥"></a>ÂàÜÈÖçÁ©∫Èó¥</h4><p>ÂèØ‰ª•‰ΩøÁî® allocate ÊñπÊ≥ï‰∏∫ ByteBuffer ÂàÜÈÖçÁ©∫Èó¥ÔºåÂÖ∂ÂÆÉ buffer Á±ª‰πüÊúâËØ•ÊñπÊ≥ï</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Bytebuffer buf = ByteBuffer.allocate(<span class="number">16</span>);</span><br></pre></td></tr></table></figure>



<h4 id="Âêë-buffer-ÂÜôÂÖ•Êï∞ÊçÆ"><a href="#Âêë-buffer-ÂÜôÂÖ•Êï∞ÊçÆ" class="headerlink" title="Âêë buffer ÂÜôÂÖ•Êï∞ÊçÆ"></a>Âêë buffer ÂÜôÂÖ•Êï∞ÊçÆ</h4><p>Êúâ‰∏§ÁßçÂäûÊ≥ï</p>
<ul>
<li>Ë∞ÉÁî® channel ÁöÑ read ÊñπÊ≥ï</li>
<li>Ë∞ÉÁî® buffer Ëá™Â∑±ÁöÑ put ÊñπÊ≥ï</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> readBytes = channel.read(buf);</span><br></pre></td></tr></table></figure>

<p>Âíå</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.put((<span class="keyword">byte</span>)<span class="number">127</span>);</span><br></pre></td></tr></table></figure>



<h4 id="‰ªé-buffer-ËØªÂèñÊï∞ÊçÆ"><a href="#‰ªé-buffer-ËØªÂèñÊï∞ÊçÆ" class="headerlink" title="‰ªé buffer ËØªÂèñÊï∞ÊçÆ"></a>‰ªé buffer ËØªÂèñÊï∞ÊçÆ</h4><p>ÂêåÊ†∑Êúâ‰∏§ÁßçÂäûÊ≥ï</p>
<ul>
<li>Ë∞ÉÁî® channel ÁöÑ write ÊñπÊ≥ï</li>
<li>Ë∞ÉÁî® buffer Ëá™Â∑±ÁöÑ get ÊñπÊ≥ï</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> writeBytes = channel.write(buf);</span><br></pre></td></tr></table></figure>

<p>Âíå</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span> b = buf.get();</span><br></pre></td></tr></table></figure>

<p>get ÊñπÊ≥ï‰ºöËÆ© position ËØªÊåáÈíàÂêëÂêéËµ∞ÔºåÂ¶ÇÊûúÊÉ≥ÈáçÂ§çËØªÂèñÊï∞ÊçÆ</p>
<ul>
<li>ÂèØ‰ª•Ë∞ÉÁî® rewind ÊñπÊ≥ïÂ∞Ü position ÈáçÊñ∞ÁΩÆ‰∏∫ 0</li>
<li>ÊàñËÄÖË∞ÉÁî® get(int i) ÊñπÊ≥ïËé∑ÂèñÁ¥¢Âºï i ÁöÑÂÜÖÂÆπÔºåÂÆÉ‰∏ç‰ºöÁßªÂä®ËØªÊåáÈíà</li>
</ul>
<h4 id="mark-Âíå-reset"><a href="#mark-Âíå-reset" class="headerlink" title="mark Âíå reset"></a>mark Âíå reset</h4><p>mark ÊòØÂú®ËØªÂèñÊó∂ÔºåÂÅö‰∏Ä‰∏™Ê†áËÆ∞ÔºåÂç≥‰Ωø position ÊîπÂèòÔºåÂè™Ë¶ÅË∞ÉÁî® reset Â∞±ËÉΩÂõûÂà∞ mark ÁöÑ‰ΩçÁΩÆ</p>
<blockquote>
<p><strong>Ê≥®ÊÑè</strong></p>
<p>rewind Âíå flip ÈÉΩ‰ºöÊ∏ÖÈô§ mark ‰ΩçÁΩÆ</p>
</blockquote>
<h4 id="Â≠óÁ¨¶‰∏≤‰∏é-ByteBuffer-‰∫íËΩ¨"><a href="#Â≠óÁ¨¶‰∏≤‰∏é-ByteBuffer-‰∫íËΩ¨" class="headerlink" title="Â≠óÁ¨¶‰∏≤‰∏é ByteBuffer ‰∫íËΩ¨"></a>Â≠óÁ¨¶‰∏≤‰∏é ByteBuffer ‰∫íËΩ¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer buffer1 = StandardCharsets.UTF_8.encode(<span class="string">&quot;‰Ω†Â•Ω&quot;</span>);</span><br><span class="line">ByteBuffer buffer2 = Charset.forName(<span class="string">&quot;utf-8&quot;</span>).encode(<span class="string">&quot;‰Ω†Â•Ω&quot;</span>);</span><br><span class="line"></span><br><span class="line">debug(buffer1);</span><br><span class="line">debug(buffer2);</span><br><span class="line"></span><br><span class="line">CharBuffer buffer3 = StandardCharsets.UTF_8.decode(buffer1);</span><br><span class="line">System.out.println(buffer3.getClass());</span><br><span class="line">System.out.println(buffer3.toString());</span><br></pre></td></tr></table></figure>

<p>ËæìÂá∫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| e4 bd a0 e5 a5 bd                               |......          |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| e4 bd a0 e5 a5 bd                               |......          |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">class java.nio.HeapCharBuffer</span><br><span class="line">‰Ω†Â•Ω</span><br></pre></td></tr></table></figure>



<h4 id="‚ö†Ô∏è-Buffer-ÁöÑÁ∫øÁ®ãÂÆâÂÖ®"><a href="#‚ö†Ô∏è-Buffer-ÁöÑÁ∫øÁ®ãÂÆâÂÖ®" class="headerlink" title="‚ö†Ô∏è Buffer ÁöÑÁ∫øÁ®ãÂÆâÂÖ®"></a>‚ö†Ô∏è Buffer ÁöÑÁ∫øÁ®ãÂÆâÂÖ®</h4><blockquote>
<p>Buffer ÊòØ<strong>ÈùûÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ</strong></p>
</blockquote>
<h3 id="2-4-Scattering-Reads"><a href="#2-4-Scattering-Reads" class="headerlink" title="2.4 Scattering Reads"></a>2.4 Scattering Reads</h3><p>ÂàÜÊï£ËØªÂèñÔºåÊúâ‰∏Ä‰∏™ÊñáÊú¨Êñá‰ª∂ 3parts.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onetwothree</span><br></pre></td></tr></table></figure>

<p>‰ΩøÁî®Â¶Ç‰∏ãÊñπÂºèËØªÂèñÔºåÂèØ‰ª•Â∞ÜÊï∞ÊçÆÂ°´ÂÖÖËá≥Â§ö‰∏™ buffer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (RandomAccessFile file = <span class="keyword">new</span> RandomAccessFile(<span class="string">&quot;helloword/3parts.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>)) &#123;</span><br><span class="line">    FileChannel channel = file.getChannel();</span><br><span class="line">    ByteBuffer a = ByteBuffer.allocate(<span class="number">3</span>);</span><br><span class="line">    ByteBuffer b = ByteBuffer.allocate(<span class="number">3</span>);</span><br><span class="line">    ByteBuffer c = ByteBuffer.allocate(<span class="number">5</span>);</span><br><span class="line">    channel.read(<span class="keyword">new</span> ByteBuffer[]&#123;a, b, c&#125;);</span><br><span class="line">    a.flip();</span><br><span class="line">    b.flip();</span><br><span class="line">    c.flip();</span><br><span class="line">    debug(a);</span><br><span class="line">    debug(b);</span><br><span class="line">    debug(c);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÁªìÊûú</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 6f 6e 65                                        |one             |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 74 77 6f                                        |two             |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 74 68 72 65 65                                  |three           |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>



<h3 id="2-5-Gathering-Writes"><a href="#2-5-Gathering-Writes" class="headerlink" title="2.5 Gathering Writes"></a>2.5 Gathering Writes</h3><p>‰ΩøÁî®Â¶Ç‰∏ãÊñπÂºèÂÜôÂÖ•ÔºåÂèØ‰ª•Â∞ÜÂ§ö‰∏™ buffer ÁöÑÊï∞ÊçÆÂ°´ÂÖÖËá≥ channel</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (RandomAccessFile file = <span class="keyword">new</span> RandomAccessFile(<span class="string">&quot;helloword/3parts.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>)) &#123;</span><br><span class="line">    FileChannel channel = file.getChannel();</span><br><span class="line">    ByteBuffer d = ByteBuffer.allocate(<span class="number">4</span>);</span><br><span class="line">    ByteBuffer e = ByteBuffer.allocate(<span class="number">4</span>);</span><br><span class="line">    channel.position(<span class="number">11</span>);</span><br><span class="line"></span><br><span class="line">    d.put(<span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;r&#x27;</span>&#125;);</span><br><span class="line">    e.put(<span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;e&#x27;</span>&#125;);</span><br><span class="line">    d.flip();</span><br><span class="line">    e.flip();</span><br><span class="line">    debug(d);</span><br><span class="line">    debug(e);</span><br><span class="line">    channel.write(<span class="keyword">new</span> ByteBuffer[]&#123;d, e&#125;);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ËæìÂá∫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 66 6f 75 72                                     |four            |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 66 69 76 65                                     |five            |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>

<p>Êñá‰ª∂ÂÜÖÂÆπ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onetwothreefourfive</span><br></pre></td></tr></table></figure>



<h3 id="2-6-ÁªÉ‰π†"><a href="#2-6-ÁªÉ‰π†" class="headerlink" title="2.6 ÁªÉ‰π†"></a>2.6 ÁªÉ‰π†</h3><p>ÁΩëÁªú‰∏äÊúâÂ§öÊù°Êï∞ÊçÆÂèëÈÄÅÁªôÊúçÂä°Á´ØÔºåÊï∞ÊçÆ‰πãÈó¥‰ΩøÁî® \n ËøõË°åÂàÜÈöî<br>‰ΩÜÁî±‰∫éÊüêÁßçÂéüÂõ†Ëøô‰∫õÊï∞ÊçÆÂú®Êé•Êî∂Êó∂ÔºåË¢´ËøõË°å‰∫ÜÈáçÊñ∞ÁªÑÂêàÔºå‰æãÂ¶ÇÂéüÂßãÊï∞ÊçÆÊúâ3Êù°‰∏∫</p>
<ul>
<li>Hello,world\n</li>
<li>I‚Äôm zhangsan\n</li>
<li>How are you?\n</li>
</ul>
<p>ÂèòÊàê‰∫Ü‰∏ãÈù¢ÁöÑ‰∏§‰∏™ byteBuffer (ÈªèÂåÖÔºåÂçäÂåÖ)</p>
<ul>
<li>Hello,world\nI‚Äôm zhangsan\nHo</li>
<li>w are you?\n</li>
</ul>
<p>Áé∞Âú®Ë¶ÅÊ±Ç‰Ω†ÁºñÂÜôÁ®ãÂ∫èÔºåÂ∞ÜÈîô‰π±ÁöÑÊï∞ÊçÆÊÅ¢Â§çÊàêÂéüÂßãÁöÑÊåâ \n ÂàÜÈöîÁöÑÊï∞ÊçÆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ByteBuffer source = ByteBuffer.allocate(<span class="number">32</span>);</span><br><span class="line">    <span class="comment">//                     11            24</span></span><br><span class="line">    source.put(<span class="string">&quot;Hello,world\nI&#x27;m zhangsan\nHo&quot;</span>.getBytes());</span><br><span class="line">    split(source);</span><br><span class="line"></span><br><span class="line">    source.put(<span class="string">&quot;w are you?\nhaha!\n&quot;</span>.getBytes());</span><br><span class="line">    split(source);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(ByteBuffer source)</span> </span>&#123;</span><br><span class="line">    source.flip();</span><br><span class="line">    <span class="keyword">int</span> oldLimit = source.limit();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; oldLimit; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (source.get(i) == <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">            ByteBuffer target = ByteBuffer.allocate(i + <span class="number">1</span> - source.position());</span><br><span class="line">            <span class="comment">// 0 ~ limit</span></span><br><span class="line">            source.limit(i + <span class="number">1</span>);</span><br><span class="line">            target.put(source); <span class="comment">// ‰ªésource ËØªÔºåÂêë target ÂÜô</span></span><br><span class="line">            debugAll(target);</span><br><span class="line">            source.limit(oldLimit);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    source.compact();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-Êñá‰ª∂ÁºñÁ®ã"><a href="#3-Êñá‰ª∂ÁºñÁ®ã" class="headerlink" title="3. Êñá‰ª∂ÁºñÁ®ã"></a>3. Êñá‰ª∂ÁºñÁ®ã</h2><h3 id="3-1-FileChannel"><a href="#3-1-FileChannel" class="headerlink" title="3.1 FileChannel"></a>3.1 FileChannel</h3><h4 id="‚ö†Ô∏è-FileChannel-Â∑•‰ΩúÊ®°Âºè"><a href="#‚ö†Ô∏è-FileChannel-Â∑•‰ΩúÊ®°Âºè" class="headerlink" title="‚ö†Ô∏è FileChannel Â∑•‰ΩúÊ®°Âºè"></a>‚ö†Ô∏è FileChannel Â∑•‰ΩúÊ®°Âºè</h4><blockquote>
<p>FileChannel Âè™ËÉΩÂ∑•‰ΩúÂú®ÈòªÂ°ûÊ®°Âºè‰∏ã</p>
</blockquote>
<h4 id="Ëé∑Âèñ"><a href="#Ëé∑Âèñ" class="headerlink" title="Ëé∑Âèñ"></a>Ëé∑Âèñ</h4><p>‰∏çËÉΩÁõ¥Êé•ÊâìÂºÄ FileChannelÔºåÂøÖÈ°ªÈÄöËøá FileInputStream„ÄÅFileOutputStream ÊàñËÄÖ RandomAccessFile Êù•Ëé∑Âèñ FileChannelÔºåÂÆÉ‰ª¨ÈÉΩÊúâ getChannel ÊñπÊ≥ï</p>
<ul>
<li>ÈÄöËøá FileInputStream Ëé∑ÂèñÁöÑ channel Âè™ËÉΩËØª</li>
<li>ÈÄöËøá FileOutputStream Ëé∑ÂèñÁöÑ channel Âè™ËÉΩÂÜô</li>
<li>ÈÄöËøá RandomAccessFile ÊòØÂê¶ËÉΩËØªÂÜôÊ†πÊçÆÊûÑÈÄ† RandomAccessFile Êó∂ÁöÑËØªÂÜôÊ®°ÂºèÂÜ≥ÂÆö</li>
</ul>
<h4 id="ËØªÂèñ"><a href="#ËØªÂèñ" class="headerlink" title="ËØªÂèñ"></a>ËØªÂèñ</h4><p>‰ºö‰ªé channel ËØªÂèñÊï∞ÊçÆÂ°´ÂÖÖ ByteBufferÔºåËøîÂõûÂÄºË°®Á§∫ËØªÂà∞‰∫ÜÂ§öÂ∞ëÂ≠óËäÇÔºå-1 Ë°®Á§∫Âà∞Ëææ‰∫ÜÊñá‰ª∂ÁöÑÊú´Â∞æ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> readBytes = channel.read(buffer);</span><br></pre></td></tr></table></figure>



<h4 id="ÂÜôÂÖ•"><a href="#ÂÜôÂÖ•" class="headerlink" title="ÂÜôÂÖ•"></a>ÂÜôÂÖ•</h4><p>ÂÜôÂÖ•ÁöÑÊ≠£Á°ÆÂßøÂäøÂ¶Ç‰∏ãÔºå SocketChannel</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer buffer = ...;</span><br><span class="line">buffer.put(...); <span class="comment">// Â≠òÂÖ•Êï∞ÊçÆ</span></span><br><span class="line">buffer.flip();   <span class="comment">// ÂàáÊç¢ËØªÊ®°Âºè</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(buffer.hasRemaining()) &#123;</span><br><span class="line">    channel.write(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Âú® while ‰∏≠Ë∞ÉÁî® channel.write ÊòØÂõ†‰∏∫ write ÊñπÊ≥ïÂπ∂‰∏çËÉΩ‰øùËØÅ‰∏ÄÊ¨°Â∞Ü buffer ‰∏≠ÁöÑÂÜÖÂÆπÂÖ®ÈÉ®ÂÜôÂÖ• channel</p>
<h4 id="ÂÖ≥Èó≠"><a href="#ÂÖ≥Èó≠" class="headerlink" title="ÂÖ≥Èó≠"></a>ÂÖ≥Èó≠</h4><p>channel ÂøÖÈ°ªÂÖ≥Èó≠Ôºå‰∏çËøáË∞ÉÁî®‰∫Ü FileInputStream„ÄÅFileOutputStream ÊàñËÄÖ RandomAccessFile ÁöÑ close ÊñπÊ≥ï‰ºöÈó¥Êé•Âú∞Ë∞ÉÁî® channel ÁöÑ close ÊñπÊ≥ï</p>
<h4 id="‰ΩçÁΩÆ"><a href="#‰ΩçÁΩÆ" class="headerlink" title="‰ΩçÁΩÆ"></a>‰ΩçÁΩÆ</h4><p>Ëé∑ÂèñÂΩìÂâç‰ΩçÁΩÆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> pos = channel.position();</span><br></pre></td></tr></table></figure>

<p>ËÆæÁΩÆÂΩìÂâç‰ΩçÁΩÆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> newPos = ...;</span><br><span class="line">channel.position(newPos);</span><br></pre></td></tr></table></figure>

<p>ËÆæÁΩÆÂΩìÂâç‰ΩçÁΩÆÊó∂ÔºåÂ¶ÇÊûúËÆæÁΩÆ‰∏∫Êñá‰ª∂ÁöÑÊú´Â∞æ</p>
<ul>
<li>ËøôÊó∂ËØªÂèñ‰ºöËøîÂõû -1 </li>
<li>ËøôÊó∂ÂÜôÂÖ•Ôºå‰ºöËøΩÂä†ÂÜÖÂÆπÔºå‰ΩÜË¶ÅÊ≥®ÊÑèÂ¶ÇÊûú position Ë∂ÖËøá‰∫ÜÊñá‰ª∂Êú´Â∞æÔºåÂÜçÂÜôÂÖ•Êó∂Âú®Êñ∞ÂÜÖÂÆπÂíåÂéüÊú´Â∞æ‰πãÈó¥‰ºöÊúâÁ©∫Ê¥ûÔºà00Ôºâ</li>
</ul>
<h4 id="Â§ßÂ∞è"><a href="#Â§ßÂ∞è" class="headerlink" title="Â§ßÂ∞è"></a>Â§ßÂ∞è</h4><p>‰ΩøÁî® size ÊñπÊ≥ïËé∑ÂèñÊñá‰ª∂ÁöÑÂ§ßÂ∞è</p>
<h4 id="Âº∫Âà∂ÂÜôÂÖ•"><a href="#Âº∫Âà∂ÂÜôÂÖ•" class="headerlink" title="Âº∫Âà∂ÂÜôÂÖ•"></a>Âº∫Âà∂ÂÜôÂÖ•</h4><p>Êìç‰ΩúÁ≥ªÁªüÂá∫‰∫éÊÄßËÉΩÁöÑËÄÉËôëÔºå‰ºöÂ∞ÜÊï∞ÊçÆÁºìÂ≠òÔºå‰∏çÊòØÁ´ãÂàªÂÜôÂÖ•Á£ÅÁõò„ÄÇÂèØ‰ª•Ë∞ÉÁî® force(true)  ÊñπÊ≥ïÂ∞ÜÊñá‰ª∂ÂÜÖÂÆπÂíåÂÖÉÊï∞ÊçÆÔºàÊñá‰ª∂ÁöÑÊùÉÈôêÁ≠â‰ø°ÊÅØÔºâÁ´ãÂàªÂÜôÂÖ•Á£ÅÁõò</p>
<h3 id="3-2-‰∏§‰∏™-Channel-‰º†ËæìÊï∞ÊçÆ"><a href="#3-2-‰∏§‰∏™-Channel-‰º†ËæìÊï∞ÊçÆ" class="headerlink" title="3.2 ‰∏§‰∏™ Channel ‰º†ËæìÊï∞ÊçÆ"></a>3.2 ‰∏§‰∏™ Channel ‰º†ËæìÊï∞ÊçÆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">String FROM = <span class="string">&quot;helloword/data.txt&quot;</span>;</span><br><span class="line">String TO = <span class="string">&quot;helloword/to.txt&quot;</span>;</span><br><span class="line"><span class="keyword">long</span> start = System.nanoTime();</span><br><span class="line"><span class="keyword">try</span> (FileChannel from = <span class="keyword">new</span> FileInputStream(FROM).getChannel();</span><br><span class="line">     FileChannel to = <span class="keyword">new</span> FileOutputStream(TO).getChannel();</span><br><span class="line">    ) &#123;</span><br><span class="line">    from.transferTo(<span class="number">0</span>, from.size(), to);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> end = System.nanoTime();</span><br><span class="line">System.out.println(<span class="string">&quot;transferTo Áî®Êó∂Ôºö&quot;</span> + (end - start) / <span class="number">1000_000.0</span>);</span><br></pre></td></tr></table></figure>

<p>ËæìÂá∫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transferTo Áî®Êó∂Ôºö8.2011</span><br></pre></td></tr></table></figure>



<p>Ë∂ÖËøá 2g Â§ßÂ∞èÁöÑÊñá‰ª∂‰º†Ëæì</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFileChannelTransferTo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                FileChannel from = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;data.txt&quot;</span>).getChannel();</span><br><span class="line">                FileChannel to = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;to.txt&quot;</span>).getChannel();</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="comment">// ÊïàÁéáÈ´òÔºåÂ∫ïÂ±Ç‰ºöÂà©Áî®Êìç‰ΩúÁ≥ªÁªüÁöÑÈõ∂Êã∑Ë¥ùËøõË°å‰ºòÂåñ</span></span><br><span class="line">            <span class="keyword">long</span> size = from.size();</span><br><span class="line">            <span class="comment">// left ÂèòÈáè‰ª£Ë°®ËøòÂâ©‰ΩôÂ§öÂ∞ëÂ≠óËäÇ</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">long</span> left = size; left &gt; <span class="number">0</span>; ) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;position:&quot;</span> + (size - left) + <span class="string">&quot; left:&quot;</span> + left);</span><br><span class="line">                left -= from.transferTo((size - left), left, to);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂÆûÈôÖ‰º†Ëæì‰∏Ä‰∏™Ë∂ÖÂ§ßÊñá‰ª∂</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">position:0 left:7769948160</span><br><span class="line">position:2147483647 left:5622464513</span><br><span class="line">position:4294967294 left:3474980866</span><br><span class="line">position:6442450941 left:1327497219</span><br></pre></td></tr></table></figure>



<h3 id="3-3-Path"><a href="#3-3-Path" class="headerlink" title="3.3 Path"></a>3.3 Path</h3><p>jdk7 ÂºïÂÖ•‰∫Ü Path Âíå Paths Á±ª</p>
<ul>
<li>Path Áî®Êù•Ë°®Á§∫Êñá‰ª∂Ë∑ØÂæÑ</li>
<li>Paths ÊòØÂ∑•ÂÖ∑Á±ªÔºåÁî®Êù•Ëé∑Âèñ Path ÂÆû‰æã</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Path source = Paths.get(<span class="string">&quot;1.txt&quot;</span>); <span class="comment">// Áõ∏ÂØπË∑ØÂæÑ ‰ΩøÁî® user.dir ÁéØÂ¢ÉÂèòÈáèÊù•ÂÆö‰Ωç 1.txt</span></span><br><span class="line"></span><br><span class="line">Path source = Paths.get(<span class="string">&quot;d:\\1.txt&quot;</span>); <span class="comment">// ÁªùÂØπË∑ØÂæÑ ‰ª£Ë°®‰∫Ü  d:\1.txt</span></span><br><span class="line"></span><br><span class="line">Path source = Paths.get(<span class="string">&quot;d:/1.txt&quot;</span>); <span class="comment">// ÁªùÂØπË∑ØÂæÑ ÂêåÊ†∑‰ª£Ë°®‰∫Ü  d:\1.txt</span></span><br><span class="line"></span><br><span class="line">Path projects = Paths.get(<span class="string">&quot;d:\\data&quot;</span>, <span class="string">&quot;projects&quot;</span>); <span class="comment">// ‰ª£Ë°®‰∫Ü  d:\data\projects</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>.</code> ‰ª£Ë°®‰∫ÜÂΩìÂâçË∑ØÂæÑ</li>
<li><code>..</code> ‰ª£Ë°®‰∫Ü‰∏ä‰∏ÄÁ∫ßË∑ØÂæÑ</li>
</ul>
<p>‰æãÂ¶ÇÁõÆÂΩïÁªìÊûÑÂ¶Ç‰∏ã</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">d:</span><br><span class="line">	|- data</span><br><span class="line">		|- projects</span><br><span class="line">			|- a</span><br><span class="line">			|- b</span><br></pre></td></tr></table></figure>

<p>‰ª£Á†Å</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Path path = Paths.get(<span class="string">&quot;d:\\data\\projects\\a\\..\\b&quot;</span>);</span><br><span class="line">System.out.println(path);</span><br><span class="line">System.out.println(path.normalize()); <span class="comment">// Ê≠£Â∏∏ÂåñË∑ØÂæÑ</span></span><br></pre></td></tr></table></figure>

<p>‰ºöËæìÂá∫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d:\data\projects\a\..\b</span><br><span class="line">d:\data\projects\b</span><br></pre></td></tr></table></figure>



<h3 id="3-4-Files"><a href="#3-4-Files" class="headerlink" title="3.4 Files"></a>3.4 Files</h3><p>Ê£ÄÊü•Êñá‰ª∂ÊòØÂê¶Â≠òÂú®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Path path = Paths.get(<span class="string">&quot;helloword/data.txt&quot;</span>);</span><br><span class="line">System.out.println(Files.exists(path));</span><br></pre></td></tr></table></figure>



<p>ÂàõÂª∫‰∏ÄÁ∫ßÁõÆÂΩï</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Path path = Paths.get(<span class="string">&quot;helloword/d1&quot;</span>);</span><br><span class="line">Files.createDirectory(path);</span><br></pre></td></tr></table></figure>

<ul>
<li>Â¶ÇÊûúÁõÆÂΩïÂ∑≤Â≠òÂú®Ôºå‰ºöÊäõÂºÇÂ∏∏ FileAlreadyExistsException</li>
<li>‰∏çËÉΩ‰∏ÄÊ¨°ÂàõÂª∫Â§öÁ∫ßÁõÆÂΩïÔºåÂê¶Âàô‰ºöÊäõÂºÇÂ∏∏ NoSuchFileException</li>
</ul>
<p>ÂàõÂª∫Â§öÁ∫ßÁõÆÂΩïÁî®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Path path = Paths.get(<span class="string">&quot;helloword/d1/d2&quot;</span>);</span><br><span class="line">Files.createDirectories(path);</span><br></pre></td></tr></table></figure>



<p>Êã∑Ë¥ùÊñá‰ª∂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Path source = Paths.get(<span class="string">&quot;helloword/data.txt&quot;</span>);</span><br><span class="line">Path target = Paths.get(<span class="string">&quot;helloword/target.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">Files.copy(source, target);</span><br></pre></td></tr></table></figure>

<ul>
<li>Â¶ÇÊûúÊñá‰ª∂Â∑≤Â≠òÂú®Ôºå‰ºöÊäõÂºÇÂ∏∏ FileAlreadyExistsException</li>
</ul>
<p>Â¶ÇÊûúÂ∏åÊúõÁî® source Ë¶ÜÁõñÊéâ targetÔºåÈúÄË¶ÅÁî® StandardCopyOption Êù•ÊéßÂà∂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Files.copy(source, target, StandardCopyOption.REPLACE_EXISTING);</span><br></pre></td></tr></table></figure>



<p>ÁßªÂä®Êñá‰ª∂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Path source = Paths.get(<span class="string">&quot;helloword/data.txt&quot;</span>);</span><br><span class="line">Path target = Paths.get(<span class="string">&quot;helloword/data.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">Files.move(source, target, StandardCopyOption.ATOMIC_MOVE);</span><br></pre></td></tr></table></figure>

<ul>
<li>StandardCopyOption.ATOMIC_MOVE ‰øùËØÅÊñá‰ª∂ÁßªÂä®ÁöÑÂéüÂ≠êÊÄß</li>
</ul>
<p>Âà†Èô§Êñá‰ª∂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Path target = Paths.get(<span class="string">&quot;helloword/target.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">Files.delete(target);</span><br></pre></td></tr></table></figure>

<ul>
<li>Â¶ÇÊûúÊñá‰ª∂‰∏çÂ≠òÂú®Ôºå‰ºöÊäõÂºÇÂ∏∏ NoSuchFileException</li>
</ul>
<p>Âà†Èô§ÁõÆÂΩï</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Path target = Paths.get(<span class="string">&quot;helloword/d1&quot;</span>);</span><br><span class="line"></span><br><span class="line">Files.delete(target);</span><br></pre></td></tr></table></figure>

<ul>
<li>Â¶ÇÊûúÁõÆÂΩïËøòÊúâÂÜÖÂÆπÔºå‰ºöÊäõÂºÇÂ∏∏ DirectoryNotEmptyException</li>
</ul>
<p>ÈÅçÂéÜÁõÆÂΩïÊñá‰ª∂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Path path = Paths.get(<span class="string">&quot;C:\\Program Files\\Java\\jdk1.8.0_91&quot;</span>);</span><br><span class="line">    AtomicInteger dirCount = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">    AtomicInteger fileCount = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">    Files.walkFileTree(path, <span class="keyword">new</span> SimpleFileVisitor&lt;Path&gt;()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> FileVisitResult <span class="title">preVisitDirectory</span><span class="params">(Path dir, BasicFileAttributes attrs)</span> </span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            System.out.println(dir);</span><br><span class="line">            dirCount.incrementAndGet();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.preVisitDirectory(dir, attrs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> FileVisitResult <span class="title">visitFile</span><span class="params">(Path file, BasicFileAttributes attrs)</span> </span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            System.out.println(file);</span><br><span class="line">            fileCount.incrementAndGet();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.visitFile(file, attrs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(dirCount); <span class="comment">// 133</span></span><br><span class="line">    System.out.println(fileCount); <span class="comment">// 1479</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ÁªüËÆ° jar ÁöÑÊï∞ÁõÆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Path path = Paths.get(<span class="string">&quot;C:\\Program Files\\Java\\jdk1.8.0_91&quot;</span>);</span><br><span class="line">AtomicInteger fileCount = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">Files.walkFileTree(path, <span class="keyword">new</span> SimpleFileVisitor&lt;Path&gt;()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FileVisitResult <span class="title">visitFile</span><span class="params">(Path file, BasicFileAttributes attrs)</span> </span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file.toFile().getName().endsWith(<span class="string">&quot;.jar&quot;</span>)) &#123;</span><br><span class="line">            fileCount.incrementAndGet();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.visitFile(file, attrs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(fileCount); <span class="comment">// 724</span></span><br></pre></td></tr></table></figure>



<p>Âà†Èô§Â§öÁ∫ßÁõÆÂΩï</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Path path = Paths.get(<span class="string">&quot;d:\\a&quot;</span>);</span><br><span class="line">Files.walkFileTree(path, <span class="keyword">new</span> SimpleFileVisitor&lt;Path&gt;()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FileVisitResult <span class="title">visitFile</span><span class="params">(Path file, BasicFileAttributes attrs)</span> </span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Files.delete(file);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.visitFile(file, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FileVisitResult <span class="title">postVisitDirectory</span><span class="params">(Path dir, IOException exc)</span> </span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Files.delete(dir);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.postVisitDirectory(dir, exc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h4 id="‚ö†Ô∏è-Âà†Èô§ÂæàÂç±Èô©"><a href="#‚ö†Ô∏è-Âà†Èô§ÂæàÂç±Èô©" class="headerlink" title="‚ö†Ô∏è Âà†Èô§ÂæàÂç±Èô©"></a>‚ö†Ô∏è Âà†Èô§ÂæàÂç±Èô©</h4><blockquote>
<p>Âà†Èô§ÊòØÂç±Èô©Êìç‰ΩúÔºåÁ°Æ‰øùË¶ÅÈÄíÂΩíÂà†Èô§ÁöÑÊñá‰ª∂Â§πÊ≤°ÊúâÈáçË¶ÅÂÜÖÂÆπ</p>
</blockquote>
<p>Êã∑Ë¥ùÂ§öÁ∫ßÁõÆÂΩï</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">String source = <span class="string">&quot;D:\\Snipaste-1.16.2-x64&quot;</span>;</span><br><span class="line">String target = <span class="string">&quot;D:\\Snipaste-1.16.2-x64aaa&quot;</span>;</span><br><span class="line"></span><br><span class="line">Files.walk(Paths.get(source)).forEach(path -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String targetName = path.toString().replace(source, target);</span><br><span class="line">        <span class="comment">// ÊòØÁõÆÂΩï</span></span><br><span class="line">        <span class="keyword">if</span> (Files.isDirectory(path)) &#123;</span><br><span class="line">            Files.createDirectory(Paths.get(targetName));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ÊòØÊôÆÈÄöÊñá‰ª∂</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (Files.isRegularFile(path)) &#123;</span><br><span class="line">            Files.copy(path, Paths.get(targetName));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">System.out.println(end - start);</span><br></pre></td></tr></table></figure>





<h2 id="4-ÁΩëÁªúÁºñÁ®ã"><a href="#4-ÁΩëÁªúÁºñÁ®ã" class="headerlink" title="4. ÁΩëÁªúÁºñÁ®ã"></a>4. ÁΩëÁªúÁºñÁ®ã</h2><h3 id="4-1-ÈùûÈòªÂ°û-vs-ÈòªÂ°û"><a href="#4-1-ÈùûÈòªÂ°û-vs-ÈòªÂ°û" class="headerlink" title="4.1 ÈùûÈòªÂ°û vs ÈòªÂ°û"></a>4.1 ÈùûÈòªÂ°û vs ÈòªÂ°û</h3><h4 id="ÈòªÂ°û"><a href="#ÈòªÂ°û" class="headerlink" title="ÈòªÂ°û"></a>ÈòªÂ°û</h4><ul>
<li>ÈòªÂ°ûÊ®°Âºè‰∏ãÔºåÁõ∏ÂÖ≥ÊñπÊ≥ïÈÉΩ‰ºöÂØºËá¥Á∫øÁ®ãÊöÇÂÅú<ul>
<li>ServerSocketChannel.accept ‰ºöÂú®Ê≤°ÊúâËøûÊé•Âª∫Á´ãÊó∂ËÆ©Á∫øÁ®ãÊöÇÂÅú</li>
<li>SocketChannel.read ‰ºöÂú®Ê≤°ÊúâÊï∞ÊçÆÂèØËØªÊó∂ËÆ©Á∫øÁ®ãÊöÇÂÅú</li>
<li>ÈòªÂ°ûÁöÑË°®Áé∞ÂÖ∂ÂÆûÂ∞±ÊòØÁ∫øÁ®ãÊöÇÂÅú‰∫ÜÔºåÊöÇÂÅúÊúüÈó¥‰∏ç‰ºöÂç†Áî® cpuÔºå‰ΩÜÁ∫øÁ®ãÁõ∏ÂΩì‰∫éÈó≤ÁΩÆ</li>
</ul>
</li>
<li>ÂçïÁ∫øÁ®ã‰∏ãÔºåÈòªÂ°ûÊñπÊ≥ï‰πãÈó¥Áõ∏‰∫íÂΩ±ÂìçÔºåÂá†‰πé‰∏çËÉΩÊ≠£Â∏∏Â∑•‰ΩúÔºåÈúÄË¶ÅÂ§öÁ∫øÁ®ãÊîØÊåÅ</li>
<li>‰ΩÜÂ§öÁ∫øÁ®ã‰∏ãÔºåÊúâÊñ∞ÁöÑÈóÆÈ¢òÔºå‰ΩìÁé∞Âú®‰ª•‰∏ãÊñπÈù¢<ul>
<li>32 ‰Ωç jvm ‰∏Ä‰∏™Á∫øÁ®ã 320kÔºå64 ‰Ωç jvm ‰∏Ä‰∏™Á∫øÁ®ã 1024kÔºåÂ¶ÇÊûúËøûÊé•Êï∞ËøáÂ§öÔºåÂøÖÁÑ∂ÂØºËá¥ OOMÔºåÂπ∂‰∏îÁ∫øÁ®ãÂ§™Â§öÔºåÂèçËÄå‰ºöÂõ†‰∏∫È¢ëÁπÅ‰∏ä‰∏ãÊñáÂàáÊç¢ÂØºËá¥ÊÄßËÉΩÈôç‰Ωé</li>
<li>ÂèØ‰ª•ÈááÁî®Á∫øÁ®ãÊ±†ÊäÄÊúØÊù•ÂáèÂ∞ëÁ∫øÁ®ãÊï∞ÂíåÁ∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢Ôºå‰ΩÜÊ≤ªÊ†á‰∏çÊ≤ªÊú¨ÔºåÂ¶ÇÊûúÊúâÂæàÂ§öËøûÊé•Âª∫Á´ãÔºå‰ΩÜÈïøÊó∂Èó¥ inactiveÔºå‰ºöÈòªÂ°ûÁ∫øÁ®ãÊ±†‰∏≠ÊâÄÊúâÁ∫øÁ®ãÔºåÂõ†Ê≠§‰∏çÈÄÇÂêàÈïøËøûÊé•ÔºåÂè™ÈÄÇÂêàÁü≠ËøûÊé•</li>
</ul>
</li>
</ul>
<p>ÊúçÂä°Âô®Á´Ø</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ‰ΩøÁî® nio Êù•ÁêÜËß£ÈòªÂ°ûÊ®°Âºè, ÂçïÁ∫øÁ®ã</span></span><br><span class="line"><span class="comment">// 0. ByteBuffer</span></span><br><span class="line">ByteBuffer buffer = ByteBuffer.allocate(<span class="number">16</span>);</span><br><span class="line"><span class="comment">// 1. ÂàõÂª∫‰∫ÜÊúçÂä°Âô®</span></span><br><span class="line">ServerSocketChannel ssc = ServerSocketChannel.open();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ÁªëÂÆöÁõëÂê¨Á´ØÂè£</span></span><br><span class="line">ssc.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8080</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. ËøûÊé•ÈõÜÂêà</span></span><br><span class="line">List&lt;SocketChannel&gt; channels = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">    <span class="comment">// 4. accept Âª∫Á´ã‰∏éÂÆ¢Êà∑Á´ØËøûÊé•Ôºå SocketChannel Áî®Êù•‰∏éÂÆ¢Êà∑Á´Ø‰πãÈó¥ÈÄö‰ø°</span></span><br><span class="line">    log.debug(<span class="string">&quot;connecting...&quot;</span>);</span><br><span class="line">    SocketChannel sc = ssc.accept(); <span class="comment">// ÈòªÂ°ûÊñπÊ≥ïÔºåÁ∫øÁ®ãÂÅúÊ≠¢ËøêË°å</span></span><br><span class="line">    log.debug(<span class="string">&quot;connected... &#123;&#125;&quot;</span>, sc);</span><br><span class="line">    channels.add(sc);</span><br><span class="line">    <span class="keyword">for</span> (SocketChannel channel : channels) &#123;</span><br><span class="line">        <span class="comment">// 5. Êé•Êî∂ÂÆ¢Êà∑Á´ØÂèëÈÄÅÁöÑÊï∞ÊçÆ</span></span><br><span class="line">        log.debug(<span class="string">&quot;before read... &#123;&#125;&quot;</span>, channel);</span><br><span class="line">        channel.read(buffer); <span class="comment">// ÈòªÂ°ûÊñπÊ≥ïÔºåÁ∫øÁ®ãÂÅúÊ≠¢ËøêË°å</span></span><br><span class="line">        buffer.flip();</span><br><span class="line">        debugRead(buffer);</span><br><span class="line">        buffer.clear();</span><br><span class="line">        log.debug(<span class="string">&quot;after read...&#123;&#125;&quot;</span>, channel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂÆ¢Êà∑Á´Ø</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SocketChannel sc = SocketChannel.open();</span><br><span class="line">sc.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;localhost&quot;</span>, <span class="number">8080</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;waiting...&quot;</span>);</span><br></pre></td></tr></table></figure>



<h4 id="ÈùûÈòªÂ°û"><a href="#ÈùûÈòªÂ°û" class="headerlink" title="ÈùûÈòªÂ°û"></a>ÈùûÈòªÂ°û</h4><ul>
<li>ÈùûÈòªÂ°ûÊ®°Âºè‰∏ãÔºåÁõ∏ÂÖ≥ÊñπÊ≥ïÈÉΩ‰ºö‰∏ç‰ºöËÆ©Á∫øÁ®ãÊöÇÂÅú<ul>
<li>Âú® ServerSocketChannel.accept Âú®Ê≤°ÊúâËøûÊé•Âª∫Á´ãÊó∂Ôºå‰ºöËøîÂõû nullÔºåÁªßÁª≠ËøêË°å</li>
<li>SocketChannel.read Âú®Ê≤°ÊúâÊï∞ÊçÆÂèØËØªÊó∂Ôºå‰ºöËøîÂõû 0Ôºå‰ΩÜÁ∫øÁ®ã‰∏çÂøÖÈòªÂ°ûÔºåÂèØ‰ª•ÂéªÊâßË°åÂÖ∂ÂÆÉ SocketChannel ÁöÑ read ÊàñÊòØÂéªÊâßË°å ServerSocketChannel.accept </li>
<li>ÂÜôÊï∞ÊçÆÊó∂ÔºåÁ∫øÁ®ãÂè™ÊòØÁ≠âÂæÖÊï∞ÊçÆÂÜôÂÖ• Channel Âç≥ÂèØÔºåÊó†ÈúÄÁ≠â Channel ÈÄöËøáÁΩëÁªúÊääÊï∞ÊçÆÂèëÈÄÅÂá∫Âéª</li>
</ul>
</li>
<li>‰ΩÜÈùûÈòªÂ°ûÊ®°Âºè‰∏ãÔºåÂç≥‰ΩøÊ≤°ÊúâËøûÊé•Âª∫Á´ãÔºåÂíåÂèØËØªÊï∞ÊçÆÔºåÁ∫øÁ®ã‰ªçÁÑ∂Âú®‰∏çÊñ≠ËøêË°åÔºåÁôΩÁôΩÊµ™Ë¥π‰∫Ü cpu</li>
<li>Êï∞ÊçÆÂ§çÂà∂ËøáÁ®ã‰∏≠ÔºåÁ∫øÁ®ãÂÆûÈôÖËøòÊòØÈòªÂ°ûÁöÑÔºàAIO ÊîπËøõÁöÑÂú∞ÊñπÔºâ</li>
</ul>
<p>ÊúçÂä°Âô®Á´ØÔºåÂÆ¢Êà∑Á´Ø‰ª£Á†Å‰∏çÂèò</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ‰ΩøÁî® nio Êù•ÁêÜËß£ÈùûÈòªÂ°ûÊ®°Âºè, ÂçïÁ∫øÁ®ã</span></span><br><span class="line"><span class="comment">// 0. ByteBuffer</span></span><br><span class="line">ByteBuffer buffer = ByteBuffer.allocate(<span class="number">16</span>);</span><br><span class="line"><span class="comment">// 1. ÂàõÂª∫‰∫ÜÊúçÂä°Âô®</span></span><br><span class="line">ServerSocketChannel ssc = ServerSocketChannel.open();</span><br><span class="line">ssc.configureBlocking(<span class="keyword">false</span>); <span class="comment">// ÈùûÈòªÂ°ûÊ®°Âºè</span></span><br><span class="line"><span class="comment">// 2. ÁªëÂÆöÁõëÂê¨Á´ØÂè£</span></span><br><span class="line">ssc.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8080</span>));</span><br><span class="line"><span class="comment">// 3. ËøûÊé•ÈõÜÂêà</span></span><br><span class="line">List&lt;SocketChannel&gt; channels = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">    <span class="comment">// 4. accept Âª∫Á´ã‰∏éÂÆ¢Êà∑Á´ØËøûÊé•Ôºå SocketChannel Áî®Êù•‰∏éÂÆ¢Êà∑Á´Ø‰πãÈó¥ÈÄö‰ø°</span></span><br><span class="line">    SocketChannel sc = ssc.accept(); <span class="comment">// ÈùûÈòªÂ°ûÔºåÁ∫øÁ®ãËøò‰ºöÁªßÁª≠ËøêË°åÔºåÂ¶ÇÊûúÊ≤°ÊúâËøûÊé•Âª∫Á´ãÔºå‰ΩÜscÊòØnull</span></span><br><span class="line">    <span class="keyword">if</span> (sc != <span class="keyword">null</span>) &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;connected... &#123;&#125;&quot;</span>, sc);</span><br><span class="line">        sc.configureBlocking(<span class="keyword">false</span>); <span class="comment">// ÈùûÈòªÂ°ûÊ®°Âºè</span></span><br><span class="line">        channels.add(sc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (SocketChannel channel : channels) &#123;</span><br><span class="line">        <span class="comment">// 5. Êé•Êî∂ÂÆ¢Êà∑Á´ØÂèëÈÄÅÁöÑÊï∞ÊçÆ</span></span><br><span class="line">        <span class="keyword">int</span> read = channel.read(buffer);<span class="comment">// ÈùûÈòªÂ°ûÔºåÁ∫øÁ®ã‰ªçÁÑ∂‰ºöÁªßÁª≠ËøêË°åÔºåÂ¶ÇÊûúÊ≤°ÊúâËØªÂà∞Êï∞ÊçÆÔºåread ËøîÂõû 0</span></span><br><span class="line">        <span class="keyword">if</span> (read &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            buffer.flip();</span><br><span class="line">            debugRead(buffer);</span><br><span class="line">            buffer.clear();</span><br><span class="line">            log.debug(<span class="string">&quot;after read...&#123;&#125;&quot;</span>, channel);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Â§öË∑ØÂ§çÁî®"><a href="#Â§öË∑ØÂ§çÁî®" class="headerlink" title="Â§öË∑ØÂ§çÁî®"></a>Â§öË∑ØÂ§çÁî®</h4><p>ÂçïÁ∫øÁ®ãÂèØ‰ª•ÈÖçÂêà Selector ÂÆåÊàêÂØπÂ§ö‰∏™ Channel ÂèØËØªÂÜô‰∫ã‰ª∂ÁöÑÁõëÊéßÔºåËøôÁß∞‰πã‰∏∫Â§öË∑ØÂ§çÁî®</p>
<ul>
<li>Â§öË∑ØÂ§çÁî®‰ªÖÈíàÂØπÁΩëÁªú IO„ÄÅÊôÆÈÄöÊñá‰ª∂ IO Ê≤°Ê≥ïÂà©Áî®Â§öË∑ØÂ§çÁî®</li>
<li>Â¶ÇÊûú‰∏çÁî® Selector ÁöÑÈùûÈòªÂ°ûÊ®°ÂºèÔºåÁ∫øÁ®ãÂ§ßÈÉ®ÂàÜÊó∂Èó¥ÈÉΩÂú®ÂÅöÊó†Áî®ÂäüÔºåËÄå Selector ËÉΩÂ§ü‰øùËØÅ<ul>
<li>ÊúâÂèØËøûÊé•‰∫ã‰ª∂Êó∂ÊâçÂéªËøûÊé•</li>
<li>ÊúâÂèØËØª‰∫ã‰ª∂ÊâçÂéªËØªÂèñ</li>
<li>ÊúâÂèØÂÜô‰∫ã‰ª∂ÊâçÂéªÂÜôÂÖ•<ul>
<li>Èôê‰∫éÁΩëÁªú‰º†ËæìËÉΩÂäõÔºåChannel Êú™ÂøÖÊó∂Êó∂ÂèØÂÜôÔºå‰∏ÄÊó¶ Channel ÂèØÂÜôÔºå‰ºöËß¶Âèë Selector ÁöÑÂèØÂÜô‰∫ã‰ª∂</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-2-Selector"><a href="#4-2-Selector" class="headerlink" title="4.2 Selector"></a>4.2 Selector</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">subgraph selector Áâà</span><br><span class="line">thread --&gt; selector</span><br><span class="line">selector --&gt; c1(channel)</span><br><span class="line">selector --&gt; c2(channel)</span><br><span class="line">selector --&gt; c3(channel)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>



<p>Â•ΩÂ§Ñ</p>
<ul>
<li>‰∏Ä‰∏™Á∫øÁ®ãÈÖçÂêà selector Â∞±ÂèØ‰ª•ÁõëÊéßÂ§ö‰∏™ channel ÁöÑ‰∫ã‰ª∂Ôºå‰∫ã‰ª∂ÂèëÁîüÁ∫øÁ®ãÊâçÂéªÂ§ÑÁêÜ„ÄÇÈÅøÂÖçÈùûÈòªÂ°ûÊ®°Âºè‰∏ãÊâÄÂÅöÊó†Áî®Âäü</li>
<li>ËÆ©Ëøô‰∏™Á∫øÁ®ãËÉΩÂ§üË¢´ÂÖÖÂàÜÂà©Áî®</li>
<li>ËäÇÁ∫¶‰∫ÜÁ∫øÁ®ãÁöÑÊï∞Èáè</li>
<li>ÂáèÂ∞ë‰∫ÜÁ∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢</li>
</ul>
<h4 id="ÂàõÂª∫"><a href="#ÂàõÂª∫" class="headerlink" title="ÂàõÂª∫"></a>ÂàõÂª∫</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Selector selector = Selector.open();</span><br></pre></td></tr></table></figure>



<h4 id="ÁªëÂÆö-Channel-‰∫ã‰ª∂"><a href="#ÁªëÂÆö-Channel-‰∫ã‰ª∂" class="headerlink" title="ÁªëÂÆö Channel ‰∫ã‰ª∂"></a>ÁªëÂÆö Channel ‰∫ã‰ª∂</h4><p>‰πüÁß∞‰πã‰∏∫Ê≥®ÂÜå‰∫ã‰ª∂ÔºåÁªëÂÆöÁöÑ‰∫ã‰ª∂ selector Êâç‰ºöÂÖ≥ÂøÉ </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">channel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">SelectionKey key = channel.register(selector, ÁªëÂÆö‰∫ã‰ª∂);</span><br></pre></td></tr></table></figure>

<ul>
<li>channel ÂøÖÈ°ªÂ∑•‰ΩúÂú®ÈùûÈòªÂ°ûÊ®°Âºè</li>
<li>FileChannel Ê≤°ÊúâÈùûÈòªÂ°ûÊ®°ÂºèÔºåÂõ†Ê≠§‰∏çËÉΩÈÖçÂêà selector ‰∏ÄËµ∑‰ΩøÁî®</li>
<li>ÁªëÂÆöÁöÑ‰∫ã‰ª∂Á±ªÂûãÂèØ‰ª•Êúâ<ul>
<li>connect - ÂÆ¢Êà∑Á´ØËøûÊé•ÊàêÂäüÊó∂Ëß¶Âèë</li>
<li>accept - ÊúçÂä°Âô®Á´ØÊàêÂäüÊé•ÂèóËøûÊé•Êó∂Ëß¶Âèë</li>
<li>read - Êï∞ÊçÆÂèØËØªÂÖ•Êó∂Ëß¶ÂèëÔºåÊúâÂõ†‰∏∫Êé•Êî∂ËÉΩÂäõÂº±ÔºåÊï∞ÊçÆÊöÇ‰∏çËÉΩËØªÂÖ•ÁöÑÊÉÖÂÜµ</li>
<li>write - Êï∞ÊçÆÂèØÂÜôÂá∫Êó∂Ëß¶ÂèëÔºåÊúâÂõ†‰∏∫ÂèëÈÄÅËÉΩÂäõÂº±ÔºåÊï∞ÊçÆÊöÇ‰∏çËÉΩÂÜôÂá∫ÁöÑÊÉÖÂÜµ</li>
</ul>
</li>
</ul>
<h4 id="ÁõëÂê¨-Channel-‰∫ã‰ª∂"><a href="#ÁõëÂê¨-Channel-‰∫ã‰ª∂" class="headerlink" title="ÁõëÂê¨ Channel ‰∫ã‰ª∂"></a>ÁõëÂê¨ Channel ‰∫ã‰ª∂</h4><p>ÂèØ‰ª•ÈÄöËøá‰∏ãÈù¢‰∏âÁßçÊñπÊ≥ïÊù•ÁõëÂê¨ÊòØÂê¶Êúâ‰∫ã‰ª∂ÂèëÁîüÔºåÊñπÊ≥ïÁöÑËøîÂõûÂÄº‰ª£Ë°®ÊúâÂ§öÂ∞ë channel ÂèëÁîü‰∫Ü‰∫ã‰ª∂</p>
<p>ÊñπÊ≥ï1ÔºåÈòªÂ°ûÁõ¥Âà∞ÁªëÂÆö‰∫ã‰ª∂ÂèëÁîü</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = selector.select();</span><br></pre></td></tr></table></figure>



<p>ÊñπÊ≥ï2ÔºåÈòªÂ°ûÁõ¥Âà∞ÁªëÂÆö‰∫ã‰ª∂ÂèëÁîüÔºåÊàñÊòØË∂ÖÊó∂ÔºàÊó∂Èó¥Âçï‰Ωç‰∏∫ msÔºâ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = selector.select(<span class="keyword">long</span> timeout);</span><br></pre></td></tr></table></figure>



<p>ÊñπÊ≥ï3Ôºå‰∏ç‰ºöÈòªÂ°ûÔºå‰πüÂ∞±ÊòØ‰∏çÁÆ°ÊúâÊ≤°Êúâ‰∫ã‰ª∂ÔºåÁ´ãÂàªËøîÂõûÔºåËá™Â∑±Ê†πÊçÆËøîÂõûÂÄºÊ£ÄÊü•ÊòØÂê¶Êúâ‰∫ã‰ª∂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = selector.selectNow();</span><br></pre></td></tr></table></figure>



<h4 id="üí°-select-‰ΩïÊó∂‰∏çÈòªÂ°û"><a href="#üí°-select-‰ΩïÊó∂‰∏çÈòªÂ°û" class="headerlink" title="üí° select ‰ΩïÊó∂‰∏çÈòªÂ°û"></a>üí° select ‰ΩïÊó∂‰∏çÈòªÂ°û</h4><blockquote>
<ul>
<li>‰∫ã‰ª∂ÂèëÁîüÊó∂<ul>
<li>ÂÆ¢Êà∑Á´ØÂèëËµ∑ËøûÊé•ËØ∑Ê±ÇÔºå‰ºöËß¶Âèë accept ‰∫ã‰ª∂</li>
<li>ÂÆ¢Êà∑Á´ØÂèëÈÄÅÊï∞ÊçÆËøáÊù•ÔºåÂÆ¢Êà∑Á´ØÊ≠£Â∏∏„ÄÅÂºÇÂ∏∏ÂÖ≥Èó≠Êó∂ÔºåÈÉΩ‰ºöËß¶Âèë read ‰∫ã‰ª∂ÔºåÂè¶Â§ñÂ¶ÇÊûúÂèëÈÄÅÁöÑÊï∞ÊçÆÂ§ß‰∫é buffer ÁºìÂÜ≤Âå∫Ôºå‰ºöËß¶ÂèëÂ§öÊ¨°ËØªÂèñ‰∫ã‰ª∂</li>
<li>channel ÂèØÂÜôÔºå‰ºöËß¶Âèë write ‰∫ã‰ª∂</li>
<li>Âú® linux ‰∏ã nio bug ÂèëÁîüÊó∂</li>
</ul>
</li>
<li>Ë∞ÉÁî® selector.wakeup()</li>
<li>Ë∞ÉÁî® selector.close()</li>
<li>selector ÊâÄÂú®Á∫øÁ®ã interrupt</li>
</ul>
</blockquote>
<h3 id="4-3-Â§ÑÁêÜ-accept-‰∫ã‰ª∂"><a href="#4-3-Â§ÑÁêÜ-accept-‰∫ã‰ª∂" class="headerlink" title="4.3 Â§ÑÁêÜ accept ‰∫ã‰ª∂"></a>4.3 Â§ÑÁêÜ accept ‰∫ã‰ª∂</h3><p>ÂÆ¢Êà∑Á´Ø‰ª£Á†Å‰∏∫</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (Socket socket = <span class="keyword">new</span> Socket(<span class="string">&quot;localhost&quot;</span>, <span class="number">8080</span>)) &#123;</span><br><span class="line">            System.out.println(socket);</span><br><span class="line">            socket.getOutputStream().write(<span class="string">&quot;world&quot;</span>.getBytes());</span><br><span class="line">            System.in.read();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ÊúçÂä°Âô®Á´Ø‰ª£Á†Å‰∏∫</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChannelDemo6</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (ServerSocketChannel channel = ServerSocketChannel.open()) &#123;</span><br><span class="line">            channel.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8080</span>));</span><br><span class="line">            System.out.println(channel);</span><br><span class="line">            Selector selector = Selector.open();</span><br><span class="line">            channel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">            channel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> count = selector.select();</span><br><span class="line"><span class="comment">//                int count = selector.selectNow();</span></span><br><span class="line">                log.debug(<span class="string">&quot;select count: &#123;&#125;&quot;</span>, count);</span><br><span class="line"><span class="comment">//                if(count &lt;= 0) &#123;</span></span><br><span class="line"><span class="comment">//                    continue;</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// Ëé∑ÂèñÊâÄÊúâ‰∫ã‰ª∂</span></span><br><span class="line">                Set&lt;SelectionKey&gt; keys = selector.selectedKeys();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ÈÅçÂéÜÊâÄÊúâ‰∫ã‰ª∂ÔºåÈÄê‰∏ÄÂ§ÑÁêÜ</span></span><br><span class="line">                Iterator&lt;SelectionKey&gt; iter = keys.iterator();</span><br><span class="line">                <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">                    SelectionKey key = iter.next();</span><br><span class="line">                    <span class="comment">// Âà§Êñ≠‰∫ã‰ª∂Á±ªÂûã</span></span><br><span class="line">                    <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">                        ServerSocketChannel c = (ServerSocketChannel) key.channel();</span><br><span class="line">                        <span class="comment">// ÂøÖÈ°ªÂ§ÑÁêÜ</span></span><br><span class="line">                        SocketChannel sc = c.accept();</span><br><span class="line">                        log.debug(<span class="string">&quot;&#123;&#125;&quot;</span>, sc);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// Â§ÑÁêÜÂÆåÊØïÔºåÂøÖÈ°ªÂ∞Ü‰∫ã‰ª∂ÁßªÈô§</span></span><br><span class="line">                    iter.remove();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="üí°-‰∫ã‰ª∂ÂèëÁîüÂêéËÉΩÂê¶‰∏çÂ§ÑÁêÜ"><a href="#üí°-‰∫ã‰ª∂ÂèëÁîüÂêéËÉΩÂê¶‰∏çÂ§ÑÁêÜ" class="headerlink" title="üí° ‰∫ã‰ª∂ÂèëÁîüÂêéËÉΩÂê¶‰∏çÂ§ÑÁêÜ"></a>üí° ‰∫ã‰ª∂ÂèëÁîüÂêéËÉΩÂê¶‰∏çÂ§ÑÁêÜ</h4><blockquote>
<p>‰∫ã‰ª∂ÂèëÁîüÂêéÔºåË¶Å‰πàÂ§ÑÁêÜÔºåË¶Å‰πàÂèñÊ∂àÔºàcancelÔºâÔºå‰∏çËÉΩ‰ªÄ‰πàÈÉΩ‰∏çÂÅöÔºåÂê¶Âàô‰∏ãÊ¨°ËØ•‰∫ã‰ª∂‰ªç‰ºöËß¶ÂèëÔºåËøôÊòØÂõ†‰∏∫ nio Â∫ïÂ±Ç‰ΩøÁî®ÁöÑÊòØÊ∞¥Âπ≥Ëß¶Âèë</p>
</blockquote>
<h3 id="4-4-Â§ÑÁêÜ-read-‰∫ã‰ª∂"><a href="#4-4-Â§ÑÁêÜ-read-‰∫ã‰ª∂" class="headerlink" title="4.4 Â§ÑÁêÜ read ‰∫ã‰ª∂"></a>4.4 Â§ÑÁêÜ read ‰∫ã‰ª∂</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChannelDemo6</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (ServerSocketChannel channel = ServerSocketChannel.open()) &#123;</span><br><span class="line">            channel.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8080</span>));</span><br><span class="line">            System.out.println(channel);</span><br><span class="line">            Selector selector = Selector.open();</span><br><span class="line">            channel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">            channel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> count = selector.select();</span><br><span class="line"><span class="comment">//                int count = selector.selectNow();</span></span><br><span class="line">                log.debug(<span class="string">&quot;select count: &#123;&#125;&quot;</span>, count);</span><br><span class="line"><span class="comment">//                if(count &lt;= 0) &#123;</span></span><br><span class="line"><span class="comment">//                    continue;</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// Ëé∑ÂèñÊâÄÊúâ‰∫ã‰ª∂</span></span><br><span class="line">                Set&lt;SelectionKey&gt; keys = selector.selectedKeys();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ÈÅçÂéÜÊâÄÊúâ‰∫ã‰ª∂ÔºåÈÄê‰∏ÄÂ§ÑÁêÜ</span></span><br><span class="line">                Iterator&lt;SelectionKey&gt; iter = keys.iterator();</span><br><span class="line">                <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">                    SelectionKey key = iter.next();</span><br><span class="line">                    <span class="comment">// Âà§Êñ≠‰∫ã‰ª∂Á±ªÂûã</span></span><br><span class="line">                    <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">                        ServerSocketChannel c = (ServerSocketChannel) key.channel();</span><br><span class="line">                        <span class="comment">// ÂøÖÈ°ªÂ§ÑÁêÜ</span></span><br><span class="line">                        SocketChannel sc = c.accept();</span><br><span class="line">                        sc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">                        sc.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                        log.debug(<span class="string">&quot;ËøûÊé•Â∑≤Âª∫Á´ã: &#123;&#125;&quot;</span>, sc);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                        SocketChannel sc = (SocketChannel) key.channel();</span><br><span class="line">                        ByteBuffer buffer = ByteBuffer.allocate(<span class="number">128</span>);</span><br><span class="line">                        <span class="keyword">int</span> read = sc.read(buffer);</span><br><span class="line">                        <span class="keyword">if</span>(read == -<span class="number">1</span>) &#123;</span><br><span class="line">                            key.cancel();</span><br><span class="line">                            sc.close();</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            buffer.flip();</span><br><span class="line">                            debug(buffer);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// Â§ÑÁêÜÂÆåÊØïÔºåÂøÖÈ°ªÂ∞Ü‰∫ã‰ª∂ÁßªÈô§</span></span><br><span class="line">                    iter.remove();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂºÄÂêØ‰∏§‰∏™ÂÆ¢Êà∑Á´ØÔºå‰øÆÊîπ‰∏Ä‰∏ãÂèëÈÄÅÊñáÂ≠óÔºåËæìÂá∫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sun.nio.ch.ServerSocketChannelImpl[/0:0:0:0:0:0:0:0:8080]</span><br><span class="line">21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1</span><br><span class="line">21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - ËøûÊé•Â∑≤Âª∫Á´ã: java.nio.channels.SocketChannel[connected local=/127.0.0.1:8080 remote=/127.0.0.1:60367]</span><br><span class="line">21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 68 65 6c 6c 6f                                  |hello           |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1</span><br><span class="line">21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - ËøûÊé•Â∑≤Âª∫Á´ã: java.nio.channels.SocketChannel[connected local=/127.0.0.1:8080 remote=/127.0.0.1:60378]</span><br><span class="line">21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 77 6f 72 6c 64                                  |world           |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>



<h4 id="üí°-‰∏∫‰ΩïË¶Å-iter-remove"><a href="#üí°-‰∏∫‰ΩïË¶Å-iter-remove" class="headerlink" title="üí° ‰∏∫‰ΩïË¶Å iter.remove()"></a>üí° ‰∏∫‰ΩïË¶Å iter.remove()</h4><blockquote>
<p>Âõ†‰∏∫ select Âú®‰∫ã‰ª∂ÂèëÁîüÂêéÔºåÂ∞±‰ºöÂ∞ÜÁõ∏ÂÖ≥ÁöÑ key ÊîæÂÖ• selectedKeys ÈõÜÂêàÔºå‰ΩÜ‰∏ç‰ºöÂú®Â§ÑÁêÜÂÆåÂêé‰ªé selectedKeys ÈõÜÂêà‰∏≠ÁßªÈô§ÔºåÈúÄË¶ÅÊàë‰ª¨Ëá™Â∑±ÁºñÁ†ÅÂà†Èô§„ÄÇ‰æãÂ¶Ç</p>
<ul>
<li>Á¨¨‰∏ÄÊ¨°Ëß¶Âèë‰∫Ü ssckey ‰∏äÁöÑ accept ‰∫ã‰ª∂ÔºåÊ≤°ÊúâÁßªÈô§ ssckey </li>
<li>Á¨¨‰∫åÊ¨°Ëß¶Âèë‰∫Ü sckey ‰∏äÁöÑ read ‰∫ã‰ª∂Ôºå‰ΩÜËøôÊó∂ selectedKeys ‰∏≠ËøòÊúâ‰∏äÊ¨°ÁöÑ ssckey ÔºåÂú®Â§ÑÁêÜÊó∂Âõ†‰∏∫Ê≤°ÊúâÁúüÊ≠£ÁöÑ serverSocket Ëøû‰∏ä‰∫ÜÔºåÂ∞±‰ºöÂØºËá¥Á©∫ÊåáÈíàÂºÇÂ∏∏</li>
</ul>
</blockquote>
<h4 id="üí°-cancel-ÁöÑ‰ΩúÁî®"><a href="#üí°-cancel-ÁöÑ‰ΩúÁî®" class="headerlink" title="üí° cancel ÁöÑ‰ΩúÁî®"></a>üí° cancel ÁöÑ‰ΩúÁî®</h4><blockquote>
<p>cancel ‰ºöÂèñÊ∂àÊ≥®ÂÜåÂú® selector ‰∏äÁöÑ channelÔºåÂπ∂‰ªé keys ÈõÜÂêà‰∏≠Âà†Èô§ key ÂêéÁª≠‰∏ç‰ºöÂÜçÁõëÂê¨‰∫ã‰ª∂</p>
</blockquote>
<h4 id="‚ö†Ô∏è-‰∏çÂ§ÑÁêÜËæπÁïåÁöÑÈóÆÈ¢ò"><a href="#‚ö†Ô∏è-‰∏çÂ§ÑÁêÜËæπÁïåÁöÑÈóÆÈ¢ò" class="headerlink" title="‚ö†Ô∏è  ‰∏çÂ§ÑÁêÜËæπÁïåÁöÑÈóÆÈ¢ò"></a>‚ö†Ô∏è  ‰∏çÂ§ÑÁêÜËæπÁïåÁöÑÈóÆÈ¢ò</h4><p>‰ª•ÂâçÊúâÂêåÂ≠¶ÂÜôËøáËøôÊ†∑ÁöÑ‰ª£Á†ÅÔºåÊÄùËÄÉÊ≥®Èáä‰∏≠‰∏§‰∏™ÈóÆÈ¢òÔºå‰ª• bio ‰∏∫‰æãÔºåÂÖ∂ÂÆû nio ÈÅìÁêÜÊòØ‰∏ÄÊ†∑ÁöÑ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocket ss=<span class="keyword">new</span> ServerSocket(<span class="number">9000</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            Socket s = ss.accept();</span><br><span class="line">            InputStream in = s.getInputStream();</span><br><span class="line">            <span class="comment">// ËøôÈáåËøô‰πàÂÜôÔºåÊúâÊ≤°ÊúâÈóÆÈ¢ò</span></span><br><span class="line">            <span class="keyword">byte</span>[] arr = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4</span>];</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> read = in.read(arr);</span><br><span class="line">                <span class="comment">// ËøôÈáåËøô‰πàÂÜôÔºåÊúâÊ≤°ÊúâÈóÆÈ¢ò</span></span><br><span class="line">                <span class="keyword">if</span>(read == -<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="keyword">new</span> String(arr, <span class="number">0</span>, read));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂÆ¢Êà∑Á´Ø</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Socket max = <span class="keyword">new</span> Socket(<span class="string">&quot;localhost&quot;</span>, <span class="number">9000</span>);</span><br><span class="line">        OutputStream out = max.getOutputStream();</span><br><span class="line">        out.write(<span class="string">&quot;hello&quot;</span>.getBytes());</span><br><span class="line">        out.write(<span class="string">&quot;world&quot;</span>.getBytes());</span><br><span class="line">        out.write(<span class="string">&quot;‰Ω†Â•Ω&quot;</span>.getBytes());</span><br><span class="line">        max.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ËæìÂá∫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hell</span><br><span class="line">owor</span><br><span class="line">ldÔøΩ</span><br><span class="line">ÔøΩÂ•Ω</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>‰∏∫‰ªÄ‰πàÔºü</p>
<h4 id="Â§ÑÁêÜÊ∂àÊÅØÁöÑËæπÁïå"><a href="#Â§ÑÁêÜÊ∂àÊÅØÁöÑËæπÁïå" class="headerlink" title="Â§ÑÁêÜÊ∂àÊÅØÁöÑËæπÁïå"></a>Â§ÑÁêÜÊ∂àÊÅØÁöÑËæπÁïå</h4><p><img "" class="lazyload placeholder" data-original="img/0023.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<ul>
<li>‰∏ÄÁßçÊÄùË∑ØÊòØÂõ∫ÂÆöÊ∂àÊÅØÈïøÂ∫¶ÔºåÊï∞ÊçÆÂåÖÂ§ßÂ∞è‰∏ÄÊ†∑ÔºåÊúçÂä°Âô®ÊåâÈ¢ÑÂÆöÈïøÂ∫¶ËØªÂèñÔºåÁº∫ÁÇπÊòØÊµ™Ë¥πÂ∏¶ÂÆΩ</li>
<li>Âè¶‰∏ÄÁßçÊÄùË∑ØÊòØÊåâÂàÜÈöîÁ¨¶ÊãÜÂàÜÔºåÁº∫ÁÇπÊòØÊïàÁéá‰Ωé</li>
<li>TLV Ê†ºÂºèÔºåÂç≥ Type Á±ªÂûã„ÄÅLength ÈïøÂ∫¶„ÄÅValue Êï∞ÊçÆÔºåÁ±ªÂûãÂíåÈïøÂ∫¶Â∑≤Áü•ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂ∞±ÂèØ‰ª•Êñπ‰æøËé∑ÂèñÊ∂àÊÅØÂ§ßÂ∞èÔºåÂàÜÈÖçÂêàÈÄÇÁöÑ bufferÔºåÁº∫ÁÇπÊòØ buffer ÈúÄË¶ÅÊèêÂâçÂàÜÈÖçÔºåÂ¶ÇÊûúÂÜÖÂÆπËøáÂ§ßÔºåÂàôÂΩ±Âìç server ÂêûÂêêÈáè<ul>
<li>Http 1.1 ÊòØ TLV Ê†ºÂºè</li>
<li>Http 2.0 ÊòØ LTV Ê†ºÂºè</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram </span><br><span class="line">participant c1 as ÂÆ¢Êà∑Á´Ø1</span><br><span class="line">participant s as ÊúçÂä°Âô®</span><br><span class="line">participant b1 as ByteBuffer1</span><br><span class="line">participant b2 as ByteBuffer2</span><br><span class="line">c1 -&gt;&gt; s: ÂèëÈÄÅ 01234567890abcdef3333\r</span><br><span class="line">s -&gt;&gt; b1: Á¨¨‰∏ÄÊ¨° read Â≠òÂÖ• 01234567890abcdef</span><br><span class="line">s -&gt;&gt; b2: Êâ©ÂÆπ</span><br><span class="line">b1 -&gt;&gt; b2: Êã∑Ë¥ù 01234567890abcdef</span><br><span class="line">s -&gt;&gt; b2: Á¨¨‰∫åÊ¨° read Â≠òÂÖ• 3333\r</span><br><span class="line">b2 -&gt;&gt; b2: 01234567890abcdef3333\r</span><br></pre></td></tr></table></figure>

<p>ÊúçÂä°Âô®Á´Ø</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(ByteBuffer source)</span> </span>&#123;</span><br><span class="line">    source.flip();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; source.limit(); i++) &#123;</span><br><span class="line">        <span class="comment">// ÊâæÂà∞‰∏ÄÊù°ÂÆåÊï¥Ê∂àÊÅØ</span></span><br><span class="line">        <span class="keyword">if</span> (source.get(i) == <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> length = i + <span class="number">1</span> - source.position();</span><br><span class="line">            <span class="comment">// ÊääËøôÊù°ÂÆåÊï¥Ê∂àÊÅØÂ≠òÂÖ•Êñ∞ÁöÑ ByteBuffer</span></span><br><span class="line">            ByteBuffer target = ByteBuffer.allocate(length);</span><br><span class="line">            <span class="comment">// ‰ªé source ËØªÔºåÂêë target ÂÜô</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; length; j++) &#123;</span><br><span class="line">                target.put(source.get());</span><br><span class="line">            &#125;</span><br><span class="line">            debugAll(target);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    source.compact(); <span class="comment">// 0123456789abcdef  position 16 limit 16</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 1. ÂàõÂª∫ selector, ÁÆ°ÁêÜÂ§ö‰∏™ channel</span></span><br><span class="line">    Selector selector = Selector.open();</span><br><span class="line">    ServerSocketChannel ssc = ServerSocketChannel.open();</span><br><span class="line">    ssc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">    <span class="comment">// 2. Âª∫Á´ã selector Âíå channel ÁöÑËÅîÁ≥ªÔºàÊ≥®ÂÜåÔºâ</span></span><br><span class="line">    <span class="comment">// SelectionKey Â∞±ÊòØÂ∞ÜÊù•‰∫ã‰ª∂ÂèëÁîüÂêéÔºåÈÄöËøáÂÆÉÂèØ‰ª•Áü•ÈÅì‰∫ã‰ª∂ÂíåÂì™‰∏™channelÁöÑ‰∫ã‰ª∂</span></span><br><span class="line">    SelectionKey sscKey = ssc.register(selector, <span class="number">0</span>, <span class="keyword">null</span>);</span><br><span class="line">    <span class="comment">// key Âè™ÂÖ≥Ê≥® accept ‰∫ã‰ª∂</span></span><br><span class="line">    sscKey.interestOps(SelectionKey.OP_ACCEPT);</span><br><span class="line">    log.debug(<span class="string">&quot;sscKey:&#123;&#125;&quot;</span>, sscKey);</span><br><span class="line">    ssc.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8080</span>));</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="comment">// 3. select ÊñπÊ≥ï, Ê≤°Êúâ‰∫ã‰ª∂ÂèëÁîüÔºåÁ∫øÁ®ãÈòªÂ°ûÔºåÊúâ‰∫ã‰ª∂ÔºåÁ∫øÁ®ãÊâç‰ºöÊÅ¢Â§çËøêË°å</span></span><br><span class="line">        <span class="comment">// select Âú®‰∫ã‰ª∂Êú™Â§ÑÁêÜÊó∂ÔºåÂÆÉ‰∏ç‰ºöÈòªÂ°û, ‰∫ã‰ª∂ÂèëÁîüÂêéË¶Å‰πàÂ§ÑÁêÜÔºåË¶Å‰πàÂèñÊ∂àÔºå‰∏çËÉΩÁΩÆ‰πã‰∏çÁêÜ</span></span><br><span class="line">        selector.select();</span><br><span class="line">        <span class="comment">// 4. Â§ÑÁêÜ‰∫ã‰ª∂, selectedKeys ÂÜÖÈÉ®ÂåÖÂê´‰∫ÜÊâÄÊúâÂèëÁîüÁöÑ‰∫ã‰ª∂</span></span><br><span class="line">        Iterator&lt;SelectionKey&gt; iter = selector.selectedKeys().iterator(); <span class="comment">// accept, read</span></span><br><span class="line">        <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">            SelectionKey key = iter.next();</span><br><span class="line">            <span class="comment">// Â§ÑÁêÜkey Êó∂ÔºåË¶Å‰ªé selectedKeys ÈõÜÂêà‰∏≠Âà†Èô§ÔºåÂê¶Âàô‰∏ãÊ¨°Â§ÑÁêÜÂ∞±‰ºöÊúâÈóÆÈ¢ò</span></span><br><span class="line">            iter.remove();</span><br><span class="line">            log.debug(<span class="string">&quot;key: &#123;&#125;&quot;</span>, key);</span><br><span class="line">            <span class="comment">// 5. Âå∫ÂàÜ‰∫ã‰ª∂Á±ªÂûã</span></span><br><span class="line">            <span class="keyword">if</span> (key.isAcceptable()) &#123; <span class="comment">// Â¶ÇÊûúÊòØ accept</span></span><br><span class="line">                ServerSocketChannel channel = (ServerSocketChannel) key.channel();</span><br><span class="line">                SocketChannel sc = channel.accept();</span><br><span class="line">                sc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">                ByteBuffer buffer = ByteBuffer.allocate(<span class="number">16</span>); <span class="comment">// attachment</span></span><br><span class="line">                <span class="comment">// Â∞Ü‰∏Ä‰∏™ byteBuffer ‰Ωú‰∏∫ÈôÑ‰ª∂ÂÖ≥ËÅîÂà∞ selectionKey ‰∏ä</span></span><br><span class="line">                SelectionKey scKey = sc.register(selector, <span class="number">0</span>, buffer);</span><br><span class="line">                scKey.interestOps(SelectionKey.OP_READ);</span><br><span class="line">                log.debug(<span class="string">&quot;&#123;&#125;&quot;</span>, sc);</span><br><span class="line">                log.debug(<span class="string">&quot;scKey:&#123;&#125;&quot;</span>, scKey);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123; <span class="comment">// Â¶ÇÊûúÊòØ read</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    SocketChannel channel = (SocketChannel) key.channel(); <span class="comment">// ÊãøÂà∞Ëß¶Âèë‰∫ã‰ª∂ÁöÑchannel</span></span><br><span class="line">                    <span class="comment">// Ëé∑Âèñ selectionKey ‰∏äÂÖ≥ËÅîÁöÑÈôÑ‰ª∂</span></span><br><span class="line">                    ByteBuffer buffer = (ByteBuffer) key.attachment();</span><br><span class="line">                    <span class="keyword">int</span> read = channel.read(buffer); <span class="comment">// Â¶ÇÊûúÊòØÊ≠£Â∏∏Êñ≠ÂºÄÔºåread ÁöÑÊñπÊ≥ïÁöÑËøîÂõûÂÄºÊòØ -1</span></span><br><span class="line">                    <span class="keyword">if</span>(read == -<span class="number">1</span>) &#123;</span><br><span class="line">                        key.cancel();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        split(buffer);</span><br><span class="line">                        <span class="comment">// ÈúÄË¶ÅÊâ©ÂÆπ</span></span><br><span class="line">                        <span class="keyword">if</span> (buffer.position() == buffer.limit()) &#123;</span><br><span class="line">                            ByteBuffer newBuffer = ByteBuffer.allocate(buffer.capacity() * <span class="number">2</span>);</span><br><span class="line">                            buffer.flip();</span><br><span class="line">                            newBuffer.put(buffer); <span class="comment">// 0123456789abcdef3333\n</span></span><br><span class="line">                            key.attach(newBuffer);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    key.cancel();  <span class="comment">// Âõ†‰∏∫ÂÆ¢Êà∑Á´ØÊñ≠ÂºÄ‰∫Ü,Âõ†Ê≠§ÈúÄË¶ÅÂ∞Ü key ÂèñÊ∂àÔºà‰ªé selector ÁöÑ keys ÈõÜÂêà‰∏≠ÁúüÊ≠£Âà†Èô§ keyÔºâ</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂÆ¢Êà∑Á´Ø</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SocketChannel sc = SocketChannel.open();</span><br><span class="line">sc.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;localhost&quot;</span>, <span class="number">8080</span>));</span><br><span class="line">SocketAddress address = sc.getLocalAddress();</span><br><span class="line"><span class="comment">// sc.write(Charset.defaultCharset().encode(&quot;hello\nworld\n&quot;));</span></span><br><span class="line">sc.write(Charset.defaultCharset().encode(<span class="string">&quot;0123\n456789abcdef&quot;</span>));</span><br><span class="line">sc.write(Charset.defaultCharset().encode(<span class="string">&quot;0123456789abcdef3333\n&quot;</span>));</span><br><span class="line">System.in.read();</span><br></pre></td></tr></table></figure>





<h4 id="ByteBuffer-Â§ßÂ∞èÂàÜÈÖç"><a href="#ByteBuffer-Â§ßÂ∞èÂàÜÈÖç" class="headerlink" title="ByteBuffer Â§ßÂ∞èÂàÜÈÖç"></a>ByteBuffer Â§ßÂ∞èÂàÜÈÖç</h4><ul>
<li>ÊØè‰∏™ channel ÈÉΩÈúÄË¶ÅËÆ∞ÂΩïÂèØËÉΩË¢´ÂàáÂàÜÁöÑÊ∂àÊÅØÔºåÂõ†‰∏∫ ByteBuffer ‰∏çËÉΩË¢´Â§ö‰∏™ channel ÂÖ±Âêå‰ΩøÁî®ÔºåÂõ†Ê≠§ÈúÄË¶Å‰∏∫ÊØè‰∏™ channel Áª¥Êä§‰∏Ä‰∏™Áã¨Á´ãÁöÑ ByteBuffer</li>
<li>ByteBuffer ‰∏çËÉΩÂ§™Â§ßÔºåÊØîÂ¶Ç‰∏Ä‰∏™ ByteBuffer 1Mb ÁöÑËØùÔºåË¶ÅÊîØÊåÅÁôæ‰∏áËøûÊé•Â∞±Ë¶Å 1Tb ÂÜÖÂ≠òÔºåÂõ†Ê≠§ÈúÄË¶ÅËÆæËÆ°Â§ßÂ∞èÂèØÂèòÁöÑ ByteBuffer<ul>
<li>‰∏ÄÁßçÊÄùË∑ØÊòØÈ¶ñÂÖàÂàÜÈÖç‰∏Ä‰∏™ËæÉÂ∞èÁöÑ bufferÔºå‰æãÂ¶Ç 4kÔºåÂ¶ÇÊûúÂèëÁé∞Êï∞ÊçÆ‰∏çÂ§üÔºåÂÜçÂàÜÈÖç 8k ÁöÑ bufferÔºåÂ∞Ü 4k buffer ÂÜÖÂÆπÊã∑Ë¥ùËá≥ 8k bufferÔºå‰ºòÁÇπÊòØÊ∂àÊÅØËøûÁª≠ÂÆπÊòìÂ§ÑÁêÜÔºåÁº∫ÁÇπÊòØÊï∞ÊçÆÊã∑Ë¥ùËÄóË¥πÊÄßËÉΩÔºåÂèÇËÄÉÂÆûÁé∞ <a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/java-performance/resizable-array.html">http://tutorials.jenkov.com/java-performance/resizable-array.html</a></li>
<li>Âè¶‰∏ÄÁßçÊÄùË∑ØÊòØÁî®Â§ö‰∏™Êï∞ÁªÑÁªÑÊàê bufferÔºå‰∏Ä‰∏™Êï∞ÁªÑ‰∏çÂ§üÔºåÊääÂ§öÂá∫Êù•ÁöÑÂÜÖÂÆπÂÜôÂÖ•Êñ∞ÁöÑÊï∞ÁªÑÔºå‰∏éÂâçÈù¢ÁöÑÂå∫Âà´ÊòØÊ∂àÊÅØÂ≠òÂÇ®‰∏çËøûÁª≠Ëß£ÊûêÂ§çÊùÇÔºå‰ºòÁÇπÊòØÈÅøÂÖç‰∫ÜÊã∑Ë¥ùÂºïËµ∑ÁöÑÊÄßËÉΩÊçüËÄó</li>
</ul>
</li>
</ul>
<h3 id="4-5-Â§ÑÁêÜ-write-‰∫ã‰ª∂"><a href="#4-5-Â§ÑÁêÜ-write-‰∫ã‰ª∂" class="headerlink" title="4.5 Â§ÑÁêÜ write ‰∫ã‰ª∂"></a>4.5 Â§ÑÁêÜ write ‰∫ã‰ª∂</h3><h4 id="‰∏ÄÊ¨°Êó†Ê≥ïÂÜôÂÆå‰æãÂ≠ê"><a href="#‰∏ÄÊ¨°Êó†Ê≥ïÂÜôÂÆå‰æãÂ≠ê" class="headerlink" title="‰∏ÄÊ¨°Êó†Ê≥ïÂÜôÂÆå‰æãÂ≠ê"></a>‰∏ÄÊ¨°Êó†Ê≥ïÂÜôÂÆå‰æãÂ≠ê</h4><ul>
<li>ÈùûÈòªÂ°ûÊ®°Âºè‰∏ãÔºåÊó†Ê≥ï‰øùËØÅÊää buffer ‰∏≠ÊâÄÊúâÊï∞ÊçÆÈÉΩÂÜôÂÖ• channelÔºåÂõ†Ê≠§ÈúÄË¶ÅËøΩË∏™ write ÊñπÊ≥ïÁöÑËøîÂõûÂÄºÔºà‰ª£Ë°®ÂÆûÈôÖÂÜôÂÖ•Â≠óËäÇÊï∞Ôºâ</li>
<li>Áî® selector ÁõëÂê¨ÊâÄÊúâ channel ÁöÑÂèØÂÜô‰∫ã‰ª∂ÔºåÊØè‰∏™ channel ÈÉΩÈúÄË¶Å‰∏Ä‰∏™ key Êù•Ë∑üË∏™ bufferÔºå‰ΩÜËøôÊ†∑Âèà‰ºöÂØºËá¥Âç†Áî®ÂÜÖÂ≠òËøáÂ§öÔºåÂ∞±Êúâ‰∏§Èò∂ÊÆµÁ≠ñÁï•<ul>
<li>ÂΩìÊ∂àÊÅØÂ§ÑÁêÜÂô®Á¨¨‰∏ÄÊ¨°ÂÜôÂÖ•Ê∂àÊÅØÊó∂ÔºåÊâçÂ∞Ü channel Ê≥®ÂÜåÂà∞ selector ‰∏ä</li>
<li>selector Ê£ÄÊü• channel ‰∏äÁöÑÂèØÂÜô‰∫ã‰ª∂ÔºåÂ¶ÇÊûúÊâÄÊúâÁöÑÊï∞ÊçÆÂÜôÂÆå‰∫ÜÔºåÂ∞±ÂèñÊ∂à channel ÁöÑÊ≥®ÂÜå</li>
<li>Â¶ÇÊûú‰∏çÂèñÊ∂àÔºå‰ºöÊØèÊ¨°ÂèØÂÜôÂùá‰ºöËß¶Âèë write ‰∫ã‰ª∂</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WriteServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocketChannel ssc = ServerSocketChannel.open();</span><br><span class="line">        ssc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        ssc.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8080</span>));</span><br><span class="line"></span><br><span class="line">        Selector selector = Selector.open();</span><br><span class="line">        ssc.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            selector.select();</span><br><span class="line"></span><br><span class="line">            Iterator&lt;SelectionKey&gt; iter = selector.selectedKeys().iterator();</span><br><span class="line">            <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">                SelectionKey key = iter.next();</span><br><span class="line">                iter.remove();</span><br><span class="line">                <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">                    SocketChannel sc = ssc.accept();</span><br><span class="line">                    sc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">                    SelectionKey sckey = sc.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                    <span class="comment">// 1. ÂêëÂÆ¢Êà∑Á´ØÂèëÈÄÅÂÜÖÂÆπ</span></span><br><span class="line">                    StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3000000</span>; i++) &#123;</span><br><span class="line">                        sb.append(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    ByteBuffer buffer = Charset.defaultCharset().encode(sb.toString());</span><br><span class="line">                    <span class="keyword">int</span> write = sc.write(buffer);</span><br><span class="line">                    <span class="comment">// 3. write Ë°®Á§∫ÂÆûÈôÖÂÜô‰∫ÜÂ§öÂ∞ëÂ≠óËäÇ</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;ÂÆûÈôÖÂÜôÂÖ•Â≠óËäÇ:&quot;</span> + write);</span><br><span class="line">                    <span class="comment">// 4. Â¶ÇÊûúÊúâÂâ©‰ΩôÊú™ËØªÂ≠óËäÇÔºåÊâçÈúÄË¶ÅÂÖ≥Ê≥®ÂÜô‰∫ã‰ª∂</span></span><br><span class="line">                    <span class="keyword">if</span> (buffer.hasRemaining()) &#123;</span><br><span class="line">                        <span class="comment">// read 1  write 4</span></span><br><span class="line">                        <span class="comment">// Âú®ÂéüÊúâÂÖ≥Ê≥®‰∫ã‰ª∂ÁöÑÂü∫Á°Ä‰∏äÔºåÂ§öÂÖ≥Ê≥® ÂÜô‰∫ã‰ª∂</span></span><br><span class="line">                        sckey.interestOps(sckey.interestOps() + SelectionKey.OP_WRITE);</span><br><span class="line">                        <span class="comment">// Êää buffer ‰Ωú‰∏∫ÈôÑ‰ª∂Âä†ÂÖ• sckey</span></span><br><span class="line">                        sckey.attach(buffer);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isWritable()) &#123;</span><br><span class="line">                    ByteBuffer buffer = (ByteBuffer) key.attachment();</span><br><span class="line">                    SocketChannel sc = (SocketChannel) key.channel();</span><br><span class="line">                    <span class="keyword">int</span> write = sc.write(buffer);</span><br><span class="line">                    System.out.println(<span class="string">&quot;ÂÆûÈôÖÂÜôÂÖ•Â≠óËäÇ:&quot;</span> + write);</span><br><span class="line">                    <span class="keyword">if</span> (!buffer.hasRemaining()) &#123; <span class="comment">// ÂÜôÂÆå‰∫Ü</span></span><br><span class="line">                        key.interestOps(key.interestOps() - SelectionKey.OP_WRITE);</span><br><span class="line">                        key.attach(<span class="keyword">null</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂÆ¢Êà∑Á´Ø</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WriteClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Selector selector = Selector.open();</span><br><span class="line">        SocketChannel sc = SocketChannel.open();</span><br><span class="line">        sc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        sc.register(selector, SelectionKey.OP_CONNECT | SelectionKey.OP_READ);</span><br><span class="line">        sc.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;localhost&quot;</span>, <span class="number">8080</span>));</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            selector.select();</span><br><span class="line">            Iterator&lt;SelectionKey&gt; iter = selector.selectedKeys().iterator();</span><br><span class="line">            <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">                SelectionKey key = iter.next();</span><br><span class="line">                iter.remove();</span><br><span class="line">                <span class="keyword">if</span> (key.isConnectable()) &#123;</span><br><span class="line">                    System.out.println(sc.finishConnect());</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                    ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line">                    count += sc.read(buffer);</span><br><span class="line">                    buffer.clear();</span><br><span class="line">                    System.out.println(count);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="üí°-write-‰∏∫‰ΩïË¶ÅÂèñÊ∂à"><a href="#üí°-write-‰∏∫‰ΩïË¶ÅÂèñÊ∂à" class="headerlink" title="üí° write ‰∏∫‰ΩïË¶ÅÂèñÊ∂à"></a>üí° write ‰∏∫‰ΩïË¶ÅÂèñÊ∂à</h4><p>Âè™Ë¶ÅÂêë channel ÂèëÈÄÅÊï∞ÊçÆÊó∂Ôºåsocket ÁºìÂÜ≤ÂèØÂÜôÔºåËøô‰∏™‰∫ã‰ª∂‰ºöÈ¢ëÁπÅËß¶ÂèëÔºåÂõ†Ê≠§Â∫îÂΩìÂè™Âú® socket ÁºìÂÜ≤Âå∫ÂÜô‰∏ç‰∏ãÊó∂ÂÜçÂÖ≥Ê≥®ÂèØÂÜô‰∫ã‰ª∂ÔºåÊï∞ÊçÆÂÜôÂÆå‰πãÂêéÂÜçÂèñÊ∂àÂÖ≥Ê≥®</p>
<h3 id="4-6-Êõ¥Ëøõ‰∏ÄÊ≠•"><a href="#4-6-Êõ¥Ëøõ‰∏ÄÊ≠•" class="headerlink" title="4.6 Êõ¥Ëøõ‰∏ÄÊ≠•"></a>4.6 Êõ¥Ëøõ‰∏ÄÊ≠•</h3><h4 id="üí°-Âà©Áî®Â§öÁ∫øÁ®ã‰ºòÂåñ"><a href="#üí°-Âà©Áî®Â§öÁ∫øÁ®ã‰ºòÂåñ" class="headerlink" title="üí° Âà©Áî®Â§öÁ∫øÁ®ã‰ºòÂåñ"></a>üí° Âà©Áî®Â§öÁ∫øÁ®ã‰ºòÂåñ</h4><blockquote>
<p>Áé∞Âú®ÈÉΩÊòØÂ§öÊ†∏ cpuÔºåËÆæËÆ°Êó∂Ë¶ÅÂÖÖÂàÜËÄÉËôëÂà´ËÆ© cpu ÁöÑÂäõÈáèË¢´ÁôΩÁôΩÊµ™Ë¥π</p>
</blockquote>
<p>ÂâçÈù¢ÁöÑ‰ª£Á†ÅÂè™Êúâ‰∏Ä‰∏™ÈÄâÊã©Âô®ÔºåÊ≤°ÊúâÂÖÖÂàÜÂà©Áî®Â§öÊ†∏ cpuÔºåÂ¶Ç‰ΩïÊîπËøõÂë¢Ôºü</p>
<p>ÂàÜ‰∏§ÁªÑÈÄâÊã©Âô®</p>
<ul>
<li>ÂçïÁ∫øÁ®ãÈÖç‰∏Ä‰∏™ÈÄâÊã©Âô®Ôºå‰∏ìÈó®Â§ÑÁêÜ accept ‰∫ã‰ª∂</li>
<li>ÂàõÂª∫ cpu Ê†∏ÂøÉÊï∞ÁöÑÁ∫øÁ®ãÔºåÊØè‰∏™Á∫øÁ®ãÈÖç‰∏Ä‰∏™ÈÄâÊã©Âô®ÔºåËΩÆÊµÅÂ§ÑÁêÜ read ‰∫ã‰ª∂</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChannelDemo7</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> BossEventLoop().register();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Slf4j</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BossEventLoop</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Selector boss;</span><br><span class="line">        <span class="keyword">private</span> WorkerEventLoop[] workers;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> start = <span class="keyword">false</span>;</span><br><span class="line">        AtomicInteger index = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!start) &#123;</span><br><span class="line">                ServerSocketChannel ssc = ServerSocketChannel.open();</span><br><span class="line">                ssc.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8080</span>));</span><br><span class="line">                ssc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">                boss = Selector.open();</span><br><span class="line">                SelectionKey ssckey = ssc.register(boss, <span class="number">0</span>, <span class="keyword">null</span>);</span><br><span class="line">                ssckey.interestOps(SelectionKey.OP_ACCEPT);</span><br><span class="line">                workers = initEventLoops();</span><br><span class="line">                <span class="keyword">new</span> Thread(<span class="keyword">this</span>, <span class="string">&quot;boss&quot;</span>).start();</span><br><span class="line">                log.debug(<span class="string">&quot;boss start...&quot;</span>);</span><br><span class="line">                start = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> WorkerEventLoop[] initEventLoops() &#123;</span><br><span class="line"><span class="comment">//        EventLoop[] eventLoops = new EventLoop[Runtime.getRuntime().availableProcessors()];</span></span><br><span class="line">            WorkerEventLoop[] workerEventLoops = <span class="keyword">new</span> WorkerEventLoop[<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; workerEventLoops.length; i++) &#123;</span><br><span class="line">                workerEventLoops[i] = <span class="keyword">new</span> WorkerEventLoop(i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> workerEventLoops;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    boss.select();</span><br><span class="line">                    Iterator&lt;SelectionKey&gt; iter = boss.selectedKeys().iterator();</span><br><span class="line">                    <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">                        SelectionKey key = iter.next();</span><br><span class="line">                        iter.remove();</span><br><span class="line">                        <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">                            ServerSocketChannel c = (ServerSocketChannel) key.channel();</span><br><span class="line">                            SocketChannel sc = c.accept();</span><br><span class="line">                            sc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">                            log.debug(<span class="string">&quot;&#123;&#125; connected&quot;</span>, sc.getRemoteAddress());</span><br><span class="line">                            workers[index.getAndIncrement() % workers.length].register(sc);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Slf4j</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WorkerEventLoop</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Selector worker;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> start = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentLinkedQueue&lt;Runnable&gt; tasks = <span class="keyword">new</span> ConcurrentLinkedQueue&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">WorkerEventLoop</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.index = index;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(SocketChannel sc)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!start) &#123;</span><br><span class="line">                worker = Selector.open();</span><br><span class="line">                <span class="keyword">new</span> Thread(<span class="keyword">this</span>, <span class="string">&quot;worker-&quot;</span> + index).start();</span><br><span class="line">                start = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            tasks.add(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    SelectionKey sckey = sc.register(worker, <span class="number">0</span>, <span class="keyword">null</span>);</span><br><span class="line">                    sckey.interestOps(SelectionKey.OP_READ);</span><br><span class="line">                    worker.selectNow();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            worker.wakeup();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    worker.select();</span><br><span class="line">                    Runnable task = tasks.poll();</span><br><span class="line">                    <span class="keyword">if</span> (task != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        task.run();</span><br><span class="line">                    &#125;</span><br><span class="line">                    Set&lt;SelectionKey&gt; keys = worker.selectedKeys();</span><br><span class="line">                    Iterator&lt;SelectionKey&gt; iter = keys.iterator();</span><br><span class="line">                    <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">                        SelectionKey key = iter.next();</span><br><span class="line">                        <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                            SocketChannel sc = (SocketChannel) key.channel();</span><br><span class="line">                            ByteBuffer buffer = ByteBuffer.allocate(<span class="number">128</span>);</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="keyword">int</span> read = sc.read(buffer);</span><br><span class="line">                                <span class="keyword">if</span> (read == -<span class="number">1</span>) &#123;</span><br><span class="line">                                    key.cancel();</span><br><span class="line">                                    sc.close();</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    buffer.flip();</span><br><span class="line">                                    log.debug(<span class="string">&quot;&#123;&#125; message:&quot;</span>, sc.getRemoteAddress());</span><br><span class="line">                                    debugAll(buffer);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                                e.printStackTrace();</span><br><span class="line">                                key.cancel();</span><br><span class="line">                                sc.close();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        iter.remove();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="üí°-Â¶Ç‰ΩïÊãøÂà∞-cpu-‰∏™Êï∞"><a href="#üí°-Â¶Ç‰ΩïÊãøÂà∞-cpu-‰∏™Êï∞" class="headerlink" title="üí° Â¶Ç‰ΩïÊãøÂà∞ cpu ‰∏™Êï∞"></a>üí° Â¶Ç‰ΩïÊãøÂà∞ cpu ‰∏™Êï∞</h4><blockquote>
<ul>
<li>Runtime.getRuntime().availableProcessors() Â¶ÇÊûúÂ∑•‰ΩúÂú® docker ÂÆπÂô®‰∏ãÔºåÂõ†‰∏∫ÂÆπÂô®‰∏çÊòØÁâ©ÁêÜÈöîÁ¶ªÁöÑÔºå‰ºöÊãøÂà∞Áâ©ÁêÜ cpu ‰∏™Êï∞ÔºåËÄå‰∏çÊòØÂÆπÂô®Áî≥ËØ∑Êó∂ÁöÑ‰∏™Êï∞</li>
<li>Ëøô‰∏™ÈóÆÈ¢òÁõ¥Âà∞ jdk 10 Êâç‰øÆÂ§çÔºå‰ΩøÁî® jvm ÂèÇÊï∞ UseContainerSupport ÈÖçÁΩÆÔºå ÈªòËÆ§ÂºÄÂêØ</li>
</ul>
</blockquote>
<h3 id="4-7-UDP"><a href="#4-7-UDP" class="headerlink" title="4.7 UDP"></a>4.7 UDP</h3><ul>
<li>UDP ÊòØÊó†ËøûÊé•ÁöÑÔºåclient ÂèëÈÄÅÊï∞ÊçÆ‰∏ç‰ºöÁÆ° server ÊòØÂê¶ÂºÄÂêØ</li>
<li>server ËøôËæπÁöÑ receive ÊñπÊ≥ï‰ºöÂ∞ÜÊé•Êî∂Âà∞ÁöÑÊï∞ÊçÆÂ≠òÂÖ• byte bufferÔºå‰ΩÜÂ¶ÇÊûúÊï∞ÊçÆÊä•ÊñáË∂ÖËøá buffer Â§ßÂ∞èÔºåÂ§öÂá∫Êù•ÁöÑÊï∞ÊçÆ‰ºöË¢´ÈªòÈªòÊäõÂºÉ</li>
</ul>
<p>È¶ñÂÖàÂêØÂä®ÊúçÂä°Âô®Á´Ø</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UdpServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (DatagramChannel channel = DatagramChannel.open()) &#123;</span><br><span class="line">            channel.socket().bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">9999</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;waiting...&quot;</span>);</span><br><span class="line">            ByteBuffer buffer = ByteBuffer.allocate(<span class="number">32</span>);</span><br><span class="line">            channel.receive(buffer);</span><br><span class="line">            buffer.flip();</span><br><span class="line">            debug(buffer);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ËæìÂá∫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">waiting...</span><br></pre></td></tr></table></figure>



<p>ËøêË°åÂÆ¢Êà∑Á´Ø</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UdpClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (DatagramChannel channel = DatagramChannel.open()) &#123;</span><br><span class="line">            ByteBuffer buffer = StandardCharsets.UTF_8.encode(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">            InetSocketAddress address = <span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;localhost&quot;</span>, <span class="number">9999</span>);</span><br><span class="line">            channel.send(buffer, address);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Êé•‰∏ãÊù•ÊúçÂä°Âô®Á´ØËæìÂá∫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 68 65 6c 6c 6f                                  |hello           |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>





<h2 id="5-NIO-vs-BIO"><a href="#5-NIO-vs-BIO" class="headerlink" title="5. NIO vs BIO"></a>5. NIO vs BIO</h2><h3 id="5-1-stream-vs-channel"><a href="#5-1-stream-vs-channel" class="headerlink" title="5.1 stream vs channel"></a>5.1 stream vs channel</h3><ul>
<li>stream ‰∏ç‰ºöËá™Âä®ÁºìÂÜ≤Êï∞ÊçÆÔºåchannel ‰ºöÂà©Áî®Á≥ªÁªüÊèê‰æõÁöÑÂèëÈÄÅÁºìÂÜ≤Âå∫„ÄÅÊé•Êî∂ÁºìÂÜ≤Âå∫ÔºàÊõ¥‰∏∫Â∫ïÂ±ÇÔºâ</li>
<li>stream ‰ªÖÊîØÊåÅÈòªÂ°û APIÔºåchannel ÂêåÊó∂ÊîØÊåÅÈòªÂ°û„ÄÅÈùûÈòªÂ°û APIÔºåÁΩëÁªú channel ÂèØÈÖçÂêà selector ÂÆûÁé∞Â§öË∑ØÂ§çÁî®</li>
<li>‰∫åËÄÖÂùá‰∏∫ÂÖ®ÂèåÂ∑•ÔºåÂç≥ËØªÂÜôÂèØ‰ª•ÂêåÊó∂ËøõË°å</li>
</ul>
<h3 id="5-2-IO-Ê®°Âûã"><a href="#5-2-IO-Ê®°Âûã" class="headerlink" title="5.2 IO Ê®°Âûã"></a>5.2 IO Ê®°Âûã</h3><p>ÂêåÊ≠•ÈòªÂ°û„ÄÅÂêåÊ≠•ÈùûÈòªÂ°û„ÄÅÂêåÊ≠•Â§öË∑ØÂ§çÁî®„ÄÅÂºÇÊ≠•ÈòªÂ°ûÔºàÊ≤°ÊúâÊ≠§ÊÉÖÂÜµÔºâ„ÄÅÂºÇÊ≠•ÈùûÈòªÂ°û</p>
<ul>
<li>ÂêåÊ≠•ÔºöÁ∫øÁ®ãËá™Â∑±ÂéªËé∑ÂèñÁªìÊûúÔºà‰∏Ä‰∏™Á∫øÁ®ãÔºâ</li>
<li>ÂºÇÊ≠•ÔºöÁ∫øÁ®ãËá™Â∑±‰∏çÂéªËé∑ÂèñÁªìÊûúÔºåËÄåÊòØÁî±ÂÖ∂ÂÆÉÁ∫øÁ®ãÈÄÅÁªìÊûúÔºàËá≥Â∞ë‰∏§‰∏™Á∫øÁ®ãÔºâ</li>
</ul>
<p>ÂΩìË∞ÉÁî®‰∏ÄÊ¨° channel.read Êàñ stream.read ÂêéÔºå‰ºöÂàáÊç¢Ëá≥Êìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏ÊÄÅÊù•ÂÆåÊàêÁúüÊ≠£Êï∞ÊçÆËØªÂèñÔºåËÄåËØªÂèñÂèàÂàÜ‰∏∫‰∏§‰∏™Èò∂ÊÆµÔºåÂàÜÂà´‰∏∫Ôºö</p>
<ul>
<li>Á≠âÂæÖÊï∞ÊçÆÈò∂ÊÆµ</li>
<li>Â§çÂà∂Êï∞ÊçÆÈò∂ÊÆµ</li>
</ul>
<p><img "" class="lazyload placeholder" data-original="img/0033.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<ul>
<li><p>ÈòªÂ°û IO</p>
<p><img "" class="lazyload placeholder" data-original="img/0039.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
</li>
<li><p>ÈùûÈòªÂ°û  IO</p>
<p><img "" class="lazyload placeholder" data-original="img/0035.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
</li>
<li><p>Â§öË∑ØÂ§çÁî®</p>
<p><img "" class="lazyload placeholder" data-original="img/0038.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
</li>
<li><p>‰ø°Âè∑È©±Âä®</p>
</li>
<li><p>ÂºÇÊ≠• IO</p>
<p><img "" class="lazyload placeholder" data-original="img/0037.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
</li>
<li><p>ÈòªÂ°û IO vs Â§öË∑ØÂ§çÁî®</p>
<p><img "" class="lazyload placeholder" data-original="img/0034.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<p><img "" class="lazyload placeholder" data-original="img/0036.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
</li>
</ul>
<h4 id="üîñ-ÂèÇËÄÉ"><a href="#üîñ-ÂèÇËÄÉ" class="headerlink" title="üîñ ÂèÇËÄÉ"></a>üîñ ÂèÇËÄÉ</h4><p>UNIX ÁΩëÁªúÁºñÁ®ã - Âç∑ I</p>
<h3 id="5-3-Èõ∂Êã∑Ë¥ù"><a href="#5-3-Èõ∂Êã∑Ë¥ù" class="headerlink" title="5.3 Èõ∂Êã∑Ë¥ù"></a>5.3 Èõ∂Êã∑Ë¥ù</h3><h4 id="‰º†Áªü-IO-ÈóÆÈ¢ò"><a href="#‰º†Áªü-IO-ÈóÆÈ¢ò" class="headerlink" title="‰º†Áªü IO ÈóÆÈ¢ò"></a>‰º†Áªü IO ÈóÆÈ¢ò</h4><p>‰º†ÁªüÁöÑ IO Â∞Ü‰∏Ä‰∏™Êñá‰ª∂ÈÄöËøá socket ÂÜôÂá∫</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">File f = <span class="keyword">new</span> File(<span class="string">&quot;helloword/data.txt&quot;</span>);</span><br><span class="line">RandomAccessFile file = <span class="keyword">new</span> RandomAccessFile(file, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>)f.length()];</span><br><span class="line">file.read(buf);</span><br><span class="line"></span><br><span class="line">Socket socket = ...;</span><br><span class="line">socket.getOutputStream().write(buf);</span><br></pre></td></tr></table></figure>

<p>ÂÜÖÈÉ®Â∑•‰ΩúÊµÅÁ®ãÊòØËøôÊ†∑ÁöÑÔºö</p>
<p><img "" class="lazyload placeholder" data-original="img/0024.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<ol>
<li><p>java Êú¨Ë∫´Âπ∂‰∏çÂÖ∑Â§á IO ËØªÂÜôËÉΩÂäõÔºåÂõ†Ê≠§ read ÊñπÊ≥ïË∞ÉÁî®ÂêéÔºåË¶Å‰ªé java Á®ãÂ∫èÁöÑ<strong>Áî®Êà∑ÊÄÅ</strong>ÂàáÊç¢Ëá≥<strong>ÂÜÖÊ†∏ÊÄÅ</strong>ÔºåÂéªË∞ÉÁî®Êìç‰ΩúÁ≥ªÁªüÔºàKernelÔºâÁöÑËØªËÉΩÂäõÔºåÂ∞ÜÊï∞ÊçÆËØªÂÖ•<strong>ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫</strong>„ÄÇËøôÊúüÈó¥Áî®Êà∑Á∫øÁ®ãÈòªÂ°ûÔºåÊìç‰ΩúÁ≥ªÁªü‰ΩøÁî® DMAÔºàDirect Memory AccessÔºâÊù•ÂÆûÁé∞Êñá‰ª∂ËØªÔºåÂÖ∂Èó¥‰πü‰∏ç‰ºö‰ΩøÁî® cpu</p>
<blockquote>
<p>DMA ‰πüÂèØ‰ª•ÁêÜËß£‰∏∫Á°¨‰ª∂ÂçïÂÖÉÔºåÁî®Êù•Ëß£Êîæ cpu ÂÆåÊàêÊñá‰ª∂ IO</p>
</blockquote>
</li>
<li><p>‰ªé<strong>ÂÜÖÊ†∏ÊÄÅ</strong>ÂàáÊç¢Âõû<strong>Áî®Êà∑ÊÄÅ</strong>ÔºåÂ∞ÜÊï∞ÊçÆ‰ªé<strong>ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫</strong>ËØªÂÖ•<strong>Áî®Êà∑ÁºìÂÜ≤Âå∫</strong>ÔºàÂç≥ byte[] bufÔºâÔºåËøôÊúüÈó¥ cpu ‰ºöÂèÇ‰∏éÊã∑Ë¥ùÔºåÊó†Ê≥ïÂà©Áî® DMA</p>
</li>
<li><p>Ë∞ÉÁî® write ÊñπÊ≥ïÔºåËøôÊó∂Â∞ÜÊï∞ÊçÆ‰ªé<strong>Áî®Êà∑ÁºìÂÜ≤Âå∫</strong>Ôºàbyte[] bufÔºâÂÜôÂÖ• <strong>socket ÁºìÂÜ≤Âå∫</strong>Ôºåcpu ‰ºöÂèÇ‰∏éÊã∑Ë¥ù</p>
</li>
<li><p>Êé•‰∏ãÊù•Ë¶ÅÂêëÁΩëÂç°ÂÜôÊï∞ÊçÆÔºåËøôÈ°πËÉΩÂäõ java Âèà‰∏çÂÖ∑Â§áÔºåÂõ†Ê≠§ÂèàÂæó‰ªé<strong>Áî®Êà∑ÊÄÅ</strong>ÂàáÊç¢Ëá≥<strong>ÂÜÖÊ†∏ÊÄÅ</strong>ÔºåË∞ÉÁî®Êìç‰ΩúÁ≥ªÁªüÁöÑÂÜôËÉΩÂäõÔºå‰ΩøÁî® DMA Â∞Ü <strong>socket ÁºìÂÜ≤Âå∫</strong>ÁöÑÊï∞ÊçÆÂÜôÂÖ•ÁΩëÂç°Ôºå‰∏ç‰ºö‰ΩøÁî® cpu</p>
</li>
</ol>
<p>ÂèØ‰ª•ÁúãÂà∞‰∏≠Èó¥ÁéØËäÇËæÉÂ§öÔºåjava ÁöÑ IO ÂÆûÈôÖ‰∏çÊòØÁâ©ÁêÜËÆæÂ§áÁ∫ßÂà´ÁöÑËØªÂÜôÔºåËÄåÊòØÁºìÂ≠òÁöÑÂ§çÂà∂ÔºåÂ∫ïÂ±ÇÁöÑÁúüÊ≠£ËØªÂÜôÊòØÊìç‰ΩúÁ≥ªÁªüÊù•ÂÆåÊàêÁöÑ</p>
<ul>
<li>Áî®Êà∑ÊÄÅ‰∏éÂÜÖÊ†∏ÊÄÅÁöÑÂàáÊç¢ÂèëÁîü‰∫Ü 3 Ê¨°ÔºåËøô‰∏™Êìç‰ΩúÊØîËæÉÈáçÈáèÁ∫ß</li>
<li>Êï∞ÊçÆÊã∑Ë¥ù‰∫ÜÂÖ± 4 Ê¨°</li>
</ul>
<h4 id="NIO-‰ºòÂåñ"><a href="#NIO-‰ºòÂåñ" class="headerlink" title="NIO ‰ºòÂåñ"></a>NIO ‰ºòÂåñ</h4><p>ÈÄöËøá DirectByteBuf </p>
<ul>
<li>ByteBuffer.allocate(10)  HeapByteBuffer ‰ΩøÁî®ÁöÑËøòÊòØ java ÂÜÖÂ≠ò</li>
<li>ByteBuffer.allocateDirect(10)  DirectByteBuffer ‰ΩøÁî®ÁöÑÊòØÊìç‰ΩúÁ≥ªÁªüÂÜÖÂ≠ò</li>
</ul>
<p><img "" class="lazyload placeholder" data-original="img/0025.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<p>Â§ßÈÉ®ÂàÜÊ≠•È™§‰∏é‰ºòÂåñÂâçÁõ∏ÂêåÔºå‰∏çÂÜçËµòËø∞„ÄÇÂîØÊúâ‰∏ÄÁÇπÔºöjava ÂèØ‰ª•‰ΩøÁî® DirectByteBuf Â∞ÜÂ†ÜÂ§ñÂÜÖÂ≠òÊò†Â∞ÑÂà∞ jvm ÂÜÖÂ≠ò‰∏≠Êù•Áõ¥Êé•ËÆøÈóÆ‰ΩøÁî®</p>
<ul>
<li>ËøôÂùóÂÜÖÂ≠ò‰∏çÂèó jvm ÂûÉÂúæÂõûÊî∂ÁöÑÂΩ±ÂìçÔºåÂõ†Ê≠§ÂÜÖÂ≠òÂú∞ÂùÄÂõ∫ÂÆöÔºåÊúâÂä©‰∫é IO ËØªÂÜô</li>
<li>java ‰∏≠ÁöÑ DirectByteBuf ÂØπË±°‰ªÖÁª¥Êä§‰∫ÜÊ≠§ÂÜÖÂ≠òÁöÑËôöÂºïÁî®ÔºåÂÜÖÂ≠òÂõûÊî∂ÂàÜÊàê‰∏§Ê≠•<ul>
<li>DirectByteBuf ÂØπË±°Ë¢´ÂûÉÂúæÂõûÊî∂ÔºåÂ∞ÜËôöÂºïÁî®Âä†ÂÖ•ÂºïÁî®ÈòüÂàó</li>
<li>ÈÄöËøá‰∏ìÈó®Á∫øÁ®ãËÆøÈóÆÂºïÁî®ÈòüÂàóÔºåÊ†πÊçÆËôöÂºïÁî®ÈáäÊîæÂ†ÜÂ§ñÂÜÖÂ≠ò</li>
</ul>
</li>
<li>ÂáèÂ∞ë‰∫Ü‰∏ÄÊ¨°Êï∞ÊçÆÊã∑Ë¥ùÔºåÁî®Êà∑ÊÄÅ‰∏éÂÜÖÊ†∏ÊÄÅÁöÑÂàáÊç¢Ê¨°Êï∞Ê≤°ÊúâÂáèÂ∞ë</li>
</ul>
<p>Ëøõ‰∏ÄÊ≠•‰ºòÂåñÔºàÂ∫ïÂ±ÇÈááÁî®‰∫Ü linux 2.1 ÂêéÊèê‰æõÁöÑ sendFile ÊñπÊ≥ïÔºâÔºåjava ‰∏≠ÂØπÂ∫îÁùÄ‰∏§‰∏™ channel Ë∞ÉÁî® transferTo/transferFrom ÊñπÊ≥ïÊã∑Ë¥ùÊï∞ÊçÆ</p>
<p><img "" class="lazyload placeholder" data-original="img/0026.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<ol>
<li>java Ë∞ÉÁî® transferTo ÊñπÊ≥ïÂêéÔºåË¶Å‰ªé java Á®ãÂ∫èÁöÑ<strong>Áî®Êà∑ÊÄÅ</strong>ÂàáÊç¢Ëá≥<strong>ÂÜÖÊ†∏ÊÄÅ</strong>Ôºå‰ΩøÁî® DMAÂ∞ÜÊï∞ÊçÆËØªÂÖ•<strong>ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫</strong>Ôºå‰∏ç‰ºö‰ΩøÁî® cpu</li>
<li>Êï∞ÊçÆ‰ªé<strong>ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫</strong>‰º†ËæìÂà∞ <strong>socket ÁºìÂÜ≤Âå∫</strong>Ôºåcpu ‰ºöÂèÇ‰∏éÊã∑Ë¥ù</li>
<li>ÊúÄÂêé‰ΩøÁî® DMA Â∞Ü <strong>socket ÁºìÂÜ≤Âå∫</strong>ÁöÑÊï∞ÊçÆÂÜôÂÖ•ÁΩëÂç°Ôºå‰∏ç‰ºö‰ΩøÁî® cpu</li>
</ol>
<p>ÂèØ‰ª•ÁúãÂà∞</p>
<ul>
<li>Âè™ÂèëÁîü‰∫Ü‰∏ÄÊ¨°Áî®Êà∑ÊÄÅ‰∏éÂÜÖÊ†∏ÊÄÅÁöÑÂàáÊç¢</li>
<li>Êï∞ÊçÆÊã∑Ë¥ù‰∫Ü 3 Ê¨°</li>
</ul>
<p>Ëøõ‰∏ÄÊ≠•‰ºòÂåñÔºàlinux 2.4Ôºâ</p>
<p><img "" class="lazyload placeholder" data-original="img/0027.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p>
<ol>
<li>java Ë∞ÉÁî® transferTo ÊñπÊ≥ïÂêéÔºåË¶Å‰ªé java Á®ãÂ∫èÁöÑ<strong>Áî®Êà∑ÊÄÅ</strong>ÂàáÊç¢Ëá≥<strong>ÂÜÖÊ†∏ÊÄÅ</strong>Ôºå‰ΩøÁî® DMAÂ∞ÜÊï∞ÊçÆËØªÂÖ•<strong>ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫</strong>Ôºå‰∏ç‰ºö‰ΩøÁî® cpu</li>
<li>Âè™‰ºöÂ∞Ü‰∏Ä‰∫õ offset Âíå length ‰ø°ÊÅØÊã∑ÂÖ• <strong>socket ÁºìÂÜ≤Âå∫</strong>ÔºåÂá†‰πéÊó†Ê∂àËÄó</li>
<li>‰ΩøÁî® DMA Â∞Ü <strong>ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫</strong>ÁöÑÊï∞ÊçÆÂÜôÂÖ•ÁΩëÂç°Ôºå‰∏ç‰ºö‰ΩøÁî® cpu</li>
</ol>
<p>Êï¥‰∏™ËøáÁ®ã‰ªÖÂè™ÂèëÁîü‰∫Ü‰∏ÄÊ¨°Áî®Êà∑ÊÄÅ‰∏éÂÜÖÊ†∏ÊÄÅÁöÑÂàáÊç¢ÔºåÊï∞ÊçÆÊã∑Ë¥ù‰∫Ü 2 Ê¨°„ÄÇÊâÄË∞ìÁöÑ„ÄêÈõ∂Êã∑Ë¥ù„ÄëÔºåÂπ∂‰∏çÊòØÁúüÊ≠£Êó†Êã∑Ë¥ùÔºåËÄåÊòØÂú®‰∏ç‰ºöÊã∑Ë¥ùÈáçÂ§çÊï∞ÊçÆÂà∞ jvm ÂÜÖÂ≠ò‰∏≠ÔºåÈõ∂Êã∑Ë¥ùÁöÑ‰ºòÁÇπÊúâ</p>
<ul>
<li>Êõ¥Â∞ëÁöÑÁî®Êà∑ÊÄÅ‰∏éÂÜÖÊ†∏ÊÄÅÁöÑÂàáÊç¢</li>
<li>‰∏çÂà©Áî® cpu ËÆ°ÁÆóÔºåÂáèÂ∞ë cpu ÁºìÂ≠ò‰º™ÂÖ±‰∫´</li>
<li>Èõ∂Êã∑Ë¥ùÈÄÇÂêàÂ∞èÊñá‰ª∂‰º†Ëæì</li>
</ul>
<h3 id="5-3-AIO"><a href="#5-3-AIO" class="headerlink" title="5.3 AIO"></a>5.3 AIO</h3><p>AIO Áî®Êù•Ëß£ÂÜ≥Êï∞ÊçÆÂ§çÂà∂Èò∂ÊÆµÁöÑÈòªÂ°ûÈóÆÈ¢ò</p>
<ul>
<li>ÂêåÊ≠•ÊÑèÂë≥ÁùÄÔºåÂú®ËøõË°åËØªÂÜôÊìç‰ΩúÊó∂ÔºåÁ∫øÁ®ãÈúÄË¶ÅÁ≠âÂæÖÁªìÊûúÔºåËøòÊòØÁõ∏ÂΩì‰∫éÈó≤ÁΩÆ</li>
<li>ÂºÇÊ≠•ÊÑèÂë≥ÁùÄÔºåÂú®ËøõË°åËØªÂÜôÊìç‰ΩúÊó∂ÔºåÁ∫øÁ®ã‰∏çÂøÖÁ≠âÂæÖÁªìÊûúÔºåËÄåÊòØÂ∞ÜÊù•Áî±Êìç‰ΩúÁ≥ªÁªüÊù•ÈÄöËøáÂõûË∞ÉÊñπÂºèÁî±Âè¶Â§ñÁöÑÁ∫øÁ®ãÊù•Ëé∑ÂæóÁªìÊûú</li>
</ul>
<blockquote>
<p>ÂºÇÊ≠•Ê®°ÂûãÈúÄË¶ÅÂ∫ïÂ±ÇÊìç‰ΩúÁ≥ªÁªüÔºàKernelÔºâÊèê‰æõÊîØÊåÅ</p>
<ul>
<li>Windows Á≥ªÁªüÈÄöËøá IOCP ÂÆûÁé∞‰∫ÜÁúüÊ≠£ÁöÑÂºÇÊ≠• IO</li>
<li>Linux Á≥ªÁªüÂºÇÊ≠• IO Âú® 2.6 ÁâàÊú¨ÂºïÂÖ•Ôºå‰ΩÜÂÖ∂Â∫ïÂ±ÇÂÆûÁé∞ËøòÊòØÁî®Â§öË∑ØÂ§çÁî®Ê®°Êãü‰∫ÜÂºÇÊ≠• IOÔºåÊÄßËÉΩÊ≤°Êúâ‰ºòÂäø</li>
</ul>
</blockquote>
<h4 id="Êñá‰ª∂-AIO"><a href="#Êñá‰ª∂-AIO" class="headerlink" title="Êñá‰ª∂ AIO"></a>Êñá‰ª∂ AIO</h4><p>ÂÖàÊù•ÁúãÁúã AsynchronousFileChannel</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AioDemo1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            AsynchronousFileChannel s = </span><br><span class="line">                AsynchronousFileChannel.open(</span><br><span class="line">                	Paths.get(<span class="string">&quot;1.txt&quot;</span>), StandardOpenOption.READ);</span><br><span class="line">            ByteBuffer buffer = ByteBuffer.allocate(<span class="number">2</span>);</span><br><span class="line">            log.debug(<span class="string">&quot;begin...&quot;</span>);</span><br><span class="line">            s.read(buffer, <span class="number">0</span>, <span class="keyword">null</span>, <span class="keyword">new</span> CompletionHandler&lt;Integer, ByteBuffer&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completed</span><span class="params">(Integer result, ByteBuffer attachment)</span> </span>&#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;read completed...&#123;&#125;&quot;</span>, result);</span><br><span class="line">                    buffer.flip();</span><br><span class="line">                    debug(buffer);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">(Throwable exc, ByteBuffer attachment)</span> </span>&#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;read failed...&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        log.debug(<span class="string">&quot;do other things...&quot;</span>);</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ËæìÂá∫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">13:44:56 [DEBUG] [main] c.i.aio.AioDemo1 - begin...</span><br><span class="line">13:44:56 [DEBUG] [main] c.i.aio.AioDemo1 - do other things...</span><br><span class="line">13:44:56 [DEBUG] [Thread-5] c.i.aio.AioDemo1 - read completed...2</span><br><span class="line">         +-------------------------------------------------+</span><br><span class="line">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br><span class="line">|00000000| 61 0d                                           |a.              |</span><br><span class="line">+--------+-------------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>

<p>ÂèØ‰ª•ÁúãÂà∞</p>
<ul>
<li>ÂìçÂ∫îÊñá‰ª∂ËØªÂèñÊàêÂäüÁöÑÊòØÂè¶‰∏Ä‰∏™Á∫øÁ®ã Thread-5</li>
<li>‰∏ªÁ∫øÁ®ãÂπ∂Ê≤°Êúâ IO Êìç‰ΩúÈòªÂ°û</li>
</ul>
<h4 id="üí°-ÂÆàÊä§Á∫øÁ®ã"><a href="#üí°-ÂÆàÊä§Á∫øÁ®ã" class="headerlink" title="üí° ÂÆàÊä§Á∫øÁ®ã"></a>üí° ÂÆàÊä§Á∫øÁ®ã</h4><p>ÈªòËÆ§Êñá‰ª∂ AIO ‰ΩøÁî®ÁöÑÁ∫øÁ®ãÈÉΩÊòØÂÆàÊä§Á∫øÁ®ãÔºåÊâÄ‰ª•ÊúÄÂêéË¶ÅÊâßË°å <code>System.in.read()</code> ‰ª•ÈÅøÂÖçÂÆàÊä§Á∫øÁ®ãÊÑèÂ§ñÁªìÊùü</p>
<h4 id="ÁΩëÁªú-AIO"><a href="#ÁΩëÁªú-AIO" class="headerlink" title="ÁΩëÁªú AIO"></a>ÁΩëÁªú AIO</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AioServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        AsynchronousServerSocketChannel ssc = AsynchronousServerSocketChannel.open();</span><br><span class="line">        ssc.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8080</span>));</span><br><span class="line">        ssc.accept(<span class="keyword">null</span>, <span class="keyword">new</span> AcceptHandler(ssc));</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeChannel</span><span class="params">(AsynchronousSocketChannel sc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;[%s] %s close\n&quot;</span>, Thread.currentThread().getName(), sc.getRemoteAddress());</span><br><span class="line">            sc.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadHandler</span> <span class="keyword">implements</span> <span class="title">CompletionHandler</span>&lt;<span class="title">Integer</span>, <span class="title">ByteBuffer</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> AsynchronousSocketChannel sc;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ReadHandler</span><span class="params">(AsynchronousSocketChannel sc)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.sc = sc;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completed</span><span class="params">(Integer result, ByteBuffer attachment)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (result == -<span class="number">1</span>) &#123;</span><br><span class="line">                    closeChannel(sc);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.printf(<span class="string">&quot;[%s] %s read\n&quot;</span>, Thread.currentThread().getName(), sc.getRemoteAddress());</span><br><span class="line">                attachment.flip();</span><br><span class="line">                System.out.println(Charset.defaultCharset().decode(attachment));</span><br><span class="line">                attachment.clear();</span><br><span class="line">                <span class="comment">// Â§ÑÁêÜÂÆåÁ¨¨‰∏Ä‰∏™ read Êó∂ÔºåÈúÄË¶ÅÂÜçÊ¨°Ë∞ÉÁî® read ÊñπÊ≥ïÊù•Â§ÑÁêÜ‰∏ã‰∏Ä‰∏™ read ‰∫ã‰ª∂</span></span><br><span class="line">                sc.read(attachment, attachment, <span class="keyword">this</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">(Throwable exc, ByteBuffer attachment)</span> </span>&#123;</span><br><span class="line">            closeChannel(sc);</span><br><span class="line">            exc.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WriteHandler</span> <span class="keyword">implements</span> <span class="title">CompletionHandler</span>&lt;<span class="title">Integer</span>, <span class="title">ByteBuffer</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> AsynchronousSocketChannel sc;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">WriteHandler</span><span class="params">(AsynchronousSocketChannel sc)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.sc = sc;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completed</span><span class="params">(Integer result, ByteBuffer attachment)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// Â¶ÇÊûú‰Ωú‰∏∫ÈôÑ‰ª∂ÁöÑ buffer ËøòÊúâÂÜÖÂÆπÔºåÈúÄË¶ÅÂÜçÊ¨° write ÂÜôÂá∫Ââ©‰ΩôÂÜÖÂÆπ</span></span><br><span class="line">            <span class="keyword">if</span> (attachment.hasRemaining()) &#123;</span><br><span class="line">                sc.write(attachment);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">(Throwable exc, ByteBuffer attachment)</span> </span>&#123;</span><br><span class="line">            exc.printStackTrace();</span><br><span class="line">            closeChannel(sc);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AcceptHandler</span> <span class="keyword">implements</span> <span class="title">CompletionHandler</span>&lt;<span class="title">AsynchronousSocketChannel</span>, <span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> AsynchronousServerSocketChannel ssc;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">AcceptHandler</span><span class="params">(AsynchronousServerSocketChannel ssc)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.ssc = ssc;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completed</span><span class="params">(AsynchronousSocketChannel sc, Object attachment)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.printf(<span class="string">&quot;[%s] %s connected\n&quot;</span>, Thread.currentThread().getName(), sc.getRemoteAddress());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            ByteBuffer buffer = ByteBuffer.allocate(<span class="number">16</span>);</span><br><span class="line">            <span class="comment">// ËØª‰∫ã‰ª∂Áî± ReadHandler Â§ÑÁêÜ</span></span><br><span class="line">            sc.read(buffer, buffer, <span class="keyword">new</span> ReadHandler(sc));</span><br><span class="line">            <span class="comment">// ÂÜô‰∫ã‰ª∂Áî± WriteHandler Â§ÑÁêÜ</span></span><br><span class="line">            sc.write(Charset.defaultCharset().encode(<span class="string">&quot;server hello!&quot;</span>), ByteBuffer.allocate(<span class="number">16</span>), <span class="keyword">new</span> WriteHandler(sc));</span><br><span class="line">            <span class="comment">// Â§ÑÁêÜÂÆåÁ¨¨‰∏Ä‰∏™ accpet Êó∂ÔºåÈúÄË¶ÅÂÜçÊ¨°Ë∞ÉÁî® accept ÊñπÊ≥ïÊù•Â§ÑÁêÜ‰∏ã‰∏Ä‰∏™ accept ‰∫ã‰ª∂</span></span><br><span class="line">            ssc.accept(<span class="keyword">null</span>, <span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">(Throwable exc, Object attachment)</span> </span>&#123;</span><br><span class="line">            exc.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>






      </div>
      <div class="post-tags-categories">
        
        <div class="tags">
          
            <a href="/tags/%E7%BD%91%E7%BB%9C/" class="">
              ÁΩëÁªú
            </a>
          
            <a href="/tags/nio/" class="">
              nio
            </a>
          
        </div>
        
      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>‰ΩúËÄÖ:  </strong>xcx</a>
    </li>
    <li class="post-copyright-link">
    <strong>ÊñáÁ´†ÈìæÊé•:  </strong>
    <a href="/2021/09/22/netty01-nio/" target="_blank" title="Netty Âü∫Á°Ä">https://xingchenxuup.github.io/2021/09/22/netty01-nio/</a>
    </li>
    <li class="post-copyright-license">
      <strong>ÁâàÊùÉÂ£∞Êòé:   </strong>
      Êú¨ÁΩëÁ´ôÊâÄÊúâÊñáÁ´†Èô§ÁâπÂà´Â£∞ÊòéÂ§ñ,ÂùáÈááÁî® <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      ËÆ∏ÂèØÂçèËÆÆ„ÄÇËΩ¨ËΩΩËØ∑Ê≥®ÊòéÂá∫Â§Ñ!
    </li>
  </ul>
<div>
      
    </article>
    <!-- ‰∏ä‰∏ÄÁØáÊñáÁ´†Âíå‰∏ã‰∏ÄÁØáÊñáÁ´† -->
    
      <!-- ÊñáÁ´†ËØ¶ÊÉÖÈ°µÁöÑ‰∏ä‰∏ÄÈ°µÂíå‰∏ã‰∏ÄÈ°µ -->
<div class="post-nav">



  
  <div class="post-nav-prev post-nav-item">
    <div class="post-nav-img lazyload" data-original="/medias/9.jpg" style="background-size: cover; 
      background-position: center center;">
    </div>
    <a href="/2021/09/22/netty04-you-hua-yu-yuan-ma/" class="post-nav-link">
      <div class="title">
        <i class="fa fa-angle-left"></i> ‰∏ä‰∏ÄÁØá:
        <div class="title-text">Netty ‰ºòÂåñ‰∏éÊ∫êÁ†Å</div>
      </div>
      
      <!-- <div class="content">
        Âõõ. ‰ºòÂåñ‰∏éÊ∫êÁ†Å1. ‰ºòÂåñ1.1 Êâ©Â±ïÂ∫èÂàóÂåñÁÆóÊ≥ïÂ∫èÂàóÂåñÔºåÂèçÂ∫èÂàóÂåñ‰∏ªË¶ÅÁî®Âú®Ê∂àÊÅØÊ≠£ÊñáÁöÑËΩ¨Êç¢‰∏ä

Â∫èÂàóÂåñÊó∂ÔºåÈúÄË¶ÅÂ∞Ü Java 
      </div> -->
    </a>
  </div>



  
  <div class="post-nav-next post-nav-item">
    <div class="post-nav-img lazyload" data-original="/medias/7.jpg" style="background-size: cover; 
      background-position: center center;">
    </div>
    <a href="/2021/09/22/netty02-ru-men/" class="post-nav-link">
      <div class="title">
        ‰∏ã‰∏ÄÁØá: <i class="fa fa-angle-right"></i>
        <div class="title-text">Netty ÂÖ•Èó®</div>
      </div>
      <!-- <div class="content">
        ‰∫å. Netty ÂÖ•Èó®1. Ê¶ÇËø∞1.1 Netty ÊòØ‰ªÄ‰πàÔºü12Netty is an asynchronous eve
      </div> -->
    </a>
  </div>

</div>

    
    

    <!-- ÊâìËµè -->
    
      <div id="appDonate" class="post-donate">
  <div id="donate_board" class="donate_bar center" ref="donate">
    <a id="btn_donate" class="btn_donate" href="javascript:;" title="ÊâìËµè" @click="showDialogDrawer()"></a>
  </div>
  <transition name="fade">
    <div 
      class="donate-box-mask"
      v-cloak 
      v-if="visible"
      @click="cancelDialogDrawer()"
    >
    </div>
  </transition>
  <transition name="bounce">
    <div class="donate-box" v-cloak v-if="visible">
      <div class="donate-box_close">
        <i class="fa fa-times" aria-hidden="true" @click="cancelDialogDrawer" pointer></i>
      </div>
      <div class="donate-box_title">
        <h4>
          ‰Ω†ÁöÑËµèËØÜÊòØÊàëÂâçËøõÁöÑÂä®Âäõ
        </h4>
      </div>
      <div class="donate-box_tab">
        <div class="Alipay" pointer :class="{'active': tabActive === 'Alipay'}" @click="changeTabActive('Alipay')">
          ÊîØ‰ªòÂÆù
        </div>
        <div class="WeChatpay" pointer :class="{'active': tabActive === 'WeChatpay'}" @click="changeTabActive('WeChatpay')">
          ÂæÆ‰ø°
        </div>
      </div>
      <div class="donate-box_img">
        <div class="AlipayImg" v-if="tabActive === 'Alipay'">
          <img src="/medias/zfb.jpg" alt="ÊîØ‰ªòÂÆùÊâìËµè" />
        </div> 
        <div class="WeChatpayImg" v-if="tabActive === 'WeChatpay'">
          <img src="/medias/wx.jpg" alt="ÂæÆ‰ø°ÊâìËµè" />
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDonate',
    data: {
      visible: false,
      tabActive: 'Alipay',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialogDrawer() {
        this.visible = true;
        // Èò≤Ê≠¢È°µÈù¢ÊªöÂä®ÔºåÂè™ËÉΩËÆ©ÂºπÊ°ÜÊªöÂä®
        // function getScroll() {
        //   return {
        //     left: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0,
        //     top: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0
        //   };
        // }
        this.top = $(document).scrollTop() // or getScroll().top
        // console.log('aa', $('.main-content'));
        body.style.cssText = 'overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
      changeTabActive(name) {
        this.tabActive = name;
      }
    },
    created() {}
  })
</script>
    

    <!-- ÂàÜ‰∫´ -->
    
      <!-- https://github.com/overtrue/share.js -->
<!-- ÊñáÁ´†ËØ¶ÊÉÖÈ°µÁöÑÂàÜ‰∫´ -->
<div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>ÂæÆ‰ø°Êâ´‰∏ÄÊâ´Âç≥ÂèØÂàÜ‰∫´ÔºÅ</p>"></div>

<script src="/js/shareJs/social-share.min.js"></script>
</script>

<style>
  .social-share {
    margin: 20px 0;
  }
</style>


    
    
    <!-- ËØÑËÆ∫ -->
    <!-- ËØÑËÆ∫ -->

  <div id="myComment">
    
      <div id="gitment-container"></div>

    
  </div>

<!-- comment script in themes\hexo-theme-bamboo\layout\_partial\scripts\index.ejs -->


  </div>

  <!-- ÁõÆÂΩï -->
  <!-- ÊñáÁ´†ËØ¶ÊÉÖÈ°µÂè≥‰æßÁõÆÂΩï -->

  <div class="toc-aside">
    <div class="toc-main">
      <div class="toc-aside-title">
        <i class="fa fa-list-ul" aria-hidden="true"></i><span>Êú¨ÊñáÁõÆÂΩï</span>
        
          <div class="toc-open-close">Êú¨ÊñáÁõÆÂΩï</div>
        
      </div>
      <div class="toc-content">
        <div class="toc"></div>
      </div>
    </div>
  </div>
  <!-- jsÂú®scriptsÁõÆÂΩï‰∏ãÁöÑÁöÑtoc.ejsÈáåÈù¢ -->
  
    <style>
      .toc-aside {
        width: 0;
        padding: 0;
      }
      .toc-aside .toc-content {
        width: 0;
      }
      .toc-aside-title span, .toc-aside-title i {
        display: none;
      }
      .main-content {
        width: 75%;
        margin: 10px auto;
      }
    </style>
  

  <script>
    function openBtnClickFn () {
      let openOrCloseBtn = $('.toc-aside .toc-aside-title .toc-open-close');
      let open = eval('' || 'false');
      openOrCloseBtn.click(function() {
        if (open === true) {
          $(".toc-aside").css({'width': 0, 'padding': 0});
          $(".toc-content").css({'width': 0});
          $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
          $(".main-content").css({'width': '75%', 'margin': '10px auto'});
          open = false;
        } else {
          $(".toc-aside").css({'width': '300px', 'padding': '0 10px'});
          $(".toc-content").css({'width': '300px'});
          $(".toc-aside-title span, .toc-aside-title i").css({'display': 'inline-block'});
          $(".main-content").css({'width': '65%', 'margin-right': '10px', 'margin-left': 'calc(35% - 350px)'});
          open = true;
        }
      });
    };
    openBtnClickFn();
    document.addEventListener('pjax:complete', function () {
      openBtnClickFn();
    })
  </script>


  

  <!-- ÂõæÁâáÊîæÂ§ß Wrap images with fancybox support -->
  <script src="/js/wrapImage.js"></script>
</div>

<!-- ÊñáÁ´†ËØ¶ÊÉÖÈ°µËÉåÊôØÂõæ -->
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;" :style="{'background-color': bgColor ? bgColor : 'transparent'}">
    <transition-group tag="ul" :name="names">
        <li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
            <img :src="image" class="bg-swiper-img">
        </li>
    </transition-group>
</div>
<script>
    var vm = new Vue({
        el: '#appBgSwiper',
        data: {
            names: '' || 'fade' || 'fade', // translate-fade fade
            mark: 0,
            img: [],
            bgColor: '',
            time: null
        },
        methods: {   //Ê∑ªÂä†ÊñπÊ≥ï
            change(i, m) {
                if (i > m) {
                    // this.names = 'fade';
                } else if (i < m) {
                    // this.names = 'fade';
                } else {
                    return;
                }
                this.mark = i;
            },
            prev() {
                // this.names = 'fade';
                this.mark--;
                if (this.mark === -1) {
                    this.mark = 3;
                    return
                }
            },
            next() {
                // this.names = 'fade';
                this.mark++;
                if (this.mark === this.img.length) {
                    this.mark = 0;
                    return
                }
            },
            autoPlay() {
                // this.names = 'fade';
                this.mark++;
                if (this.mark === this.img.length) {
                    this.mark = 0;
                    return
                }
            },
            play() {
                let bgImgDelay = '' || '180000'
                let delay = parseInt(bgImgDelay) || 180000;
                this.time = setInterval(this.autoPlay, delay);
            },
            enter() {
                clearInterval(this.time);
            },
            leave() {
                this.play();
            }
        },
        created() {
            this.play()
        },
        beforeDestroy() {
            clearInterval(this.time);
        },
        mounted() {
            let prop = ''|| '';
            let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://') 
            if (isImg) {
                let img = prop.split(',');
                let configRoot = '/'
                let arrImg = [];
                img.forEach(el => {
                    var Expression=/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
			        var objExp = new RegExp(Expression);

                    if(objExp.test(el)) {
                        // http or https
                        arrImg.push(el);
                    } else {
                        // Èùûhttp or httpsÂºÄÂ§¥
                        // Êú¨Âú∞Êñá‰ª∂
                        let firstStr = el.charAt(0);
                        if (firstStr == '/') {
                            el = el.substr(1); // Âà†Èô§Á¨¨‰∏Ä‰∏™Â≠óÁ¨¶ '/',Âõ†‰∏∫ configRootÊúÄÂêé‰∏Ä‰∏™Â≠óÁ¨¶‰∏∫ /
                        }
                        el = configRoot + el;
                        arrImg.push(el);
                    }
                })
                this.img = arrImg;
            } else {
                this.bgColor = prop;
            }
        }
    })
</script>

<style>
    .bg-swiper-box {
        position: absolute;
        display: block;
        width: 100%;
        height: 100%;
    }
    .bg-swiper-img {
        object-fit: cover;
        width: 100%;
        height: 100%;
    }
</style>

      </main>
    </div>

    <!-- È°µËÑö -->
    
  
  <div class="footer bg-color">
    <div class="footer-main">
      
        
          <div class="link">
            
          </div>
        
      
        
          <div class="footer-copyright">
            <p>Copyright ¬© 2019 - 2020 <a target="_blank" rel="noopener" href="https://github.com/yuang01">yuang01</a> | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/yuang01/theme">Bamboo</a> </p>

          </div>
        
      
        
          
            <!-- ‰∏çËíúÂ≠êÁªüËÆ° -->
            <!-- ‰∏çËíúÂ≠êÁªüËÆ° -->
<span id="busuanzi_container_site_pv">
      <i class="fa fa-eye" aria-hidden="true"></i>Êú¨Á´ôÊÄªËÆøÈóÆÈáèÔºö<span id="busuanzi_value_site_pv"></span> Ê¨°
</span>
<span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_uv" style='display:none'>
      <i class="fa fa-users" aria-hidden="true"></i>Êú¨Á´ôËÆøÂÆ¢Êï∞Ôºö<span id="busuanzi_value_site_uv"></span> ‰∫∫
</span>

          
        
      
        
          <div class="footer-custom">
            
          </div>
        
      
    </div>
  </div>



    <!-- Ê∏≤ÊüìÊöóÈªëÊåâÈíÆ -->
    
      <div class="dark">
  <div class="dark-content">
    <i class="fa fa-moon-o" aria-hidden="true"></i>
    <!-- <span>ÂÖ≥ÁÅØ</span> -->
  </div>
  
</div>

<script>
  $(function() {
    let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
    if (isDark) {
      $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fa fa-lightbulb-o" aria-hidden="true"></i>
          </div>
          `
        );
    }
    $('.dark').click(function() {
      if ($(document.body).is('.darkModel')) {
        $(document.body).removeClass('darkModel');
        localStorage.setItem('dark', false);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fa fa-moon-o" aria-hidden="true"></i>
          </div>
          `
        );
      } else {
        $(document.body).addClass('darkModel');
        localStorage.setItem('dark', true);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fa fa-lightbulb-o" aria-hidden="true"></i>
          </div>
          `
        );
      }
    })
  })
</script>
    
    <!-- Ê∏≤ÊüìÂõûÂà∞È°∂ÈÉ®ÊåâÈíÆ -->
    
      <div class="goTop top-btn-color" pointer>
  <i class="fa fa-arrow-up" aria-hidden="true"></i>
</div>
<script src="/js/goTop.js"></script>
    
    <!-- Ê∏≤ÊüìÂ∑¶‰∏ãËßíÈü≥‰πêÊí≠ÊîæÂô® -->
    
      <link rel="stylesheet" href="/js/aplayer/APlayer@1.10.1.min.css">
<style>
.aplayer .aplayer-lrc p {
  
  font-size: 12px;
  font-weight: 700;
  line-height: 16px !important;
}

.aplayer .aplayer-lrc p.aplayer-lrc-current {
  
  font-size: 15px;
  color: #42b983;
}


.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
  left: -66px !important;
}

.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
  left: 0px !important;
}


</style>
<meting-js  
  class=""
  server="tencent"
  type="playlist"
  id="8062553743"
  fixed='true'
  autoplay='false'
  theme='#42b983'
  loop='all'
  order='random'
  preload='auto'
  volume='0.7'
  list-folded='true'
>
</meting-js>

<!-- <style>
  #aplayer {
    position: fixed;
    left: 0;
    bottom: 300px;
  }
</style> -->
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    

    <!-- ÂõæÁâáÊîæÂ§ß -->
    
      <script src="/js/fancybox/jquery.fancybox.min.js"></script>
    

    <!-- ÁôæÂ∫¶Ëß£Êûê -->
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <!-- ËÉåÊôØÂΩ©Â∏¶ -->
    
      <script type="text/javascript" size="100" alpha='0.4' zIndex="-1" src="/js/ribbon.min.js"></script>
    
    
    <script src="/js/app.js" data-pjax></script>
    
    <!-- ÊñáÁ´†ÁõÆÂΩïÊâÄÈúÄjs -->
<link href="/js/tocbot/tocbot.css" rel="stylesheet">
<script src="/js/tocbot/tocbot.min.js"></script>

<script>
  var headerEl = 'h2, h3, h4',  //headers 
      content = '.post-detail',//ÊñáÁ´†ÂÆπÂô®
      idArr = {};  //Ê†áÈ¢òÊï∞ÁªÑ‰ª•Á°ÆÂÆöÊòØÂê¶Â¢ûÂä†Á¥¢Âºïid
      //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -80,
    headingsOffset: -($(window).height() * 0.4 - 45),
    positionFixedSelector: '.toc-main',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //ÂéªÈô§Á©∫Ê†º‰ª•ÂèäÂ§ö‰ΩôÊ†áÁÇπ
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\Ôºö|\Ôºå|\„ÄÇ]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //idÂ∑≤ÁªèÂ≠òÂú®
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //idÊú™Â≠òÂú®
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    tocbot.init(option);
    
  }


  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
    }
  });

  
</script>

<style>
.is-position-fixed {
  position:sticky !important;
  top: 74px;
}
.toc-main ul {
  counter-reset: show-list;
}
.toc-main ul li::before {
  content: counter(item)".";
  display: block;
  position: absolute;
  left: 12px;
  top:0;
}
/* .toc > .toc-list {
  padding-left: 35px;
}
.toc>.toc-list li {
  list-style: decimal;
}
.toc-list {
  padding-left: 25px;
} */
</style> 

<!-- Ê∏≤ÊüìissuesÊ†áÁ≠æÈáåÁöÑÂÜÖÂÆπ -->
<script>
  function loadIssuesJS() {
    if ($(".post-detail").find(".issues-api").length == 0) {
      return;
    } 
    loadScript('/js/issues/index.js');
  };
  $(function () {
    loadIssuesJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof IssuesAPI == "undefined") {
      loadIssuesJS();
    }
  })
</script>

<!-- ËæìÂÖ•Ê°ÜÊâìÂ≠óÁâπÊïà -->
<!-- ËæìÂÖ•Ê°ÜÊâìÂ≠óÁâπÊïà -->

  <script src="/js/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;  // ÊâìÂºÄÈöèÊú∫È¢úËâ≤ÁâπÊïà
    POWERMODE.shake = false;    // ÂÖ≥Èó≠ËæìÂÖ•Ê°ÜÊäñÂä®
    document.body.addEventListener('input', POWERMODE);//ÁõëÂê¨ÊâìÂ≠ó‰∫ã‰ª∂
  </script>


<!-- markdown‰ª£Á†Å‰∏ÄÈîÆÂ§çÂà∂ÂäüËÉΩ -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.css">
  <script src="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.umd.min.js"></script>
  <script src="/js/clipboard/clipboard.min.js"></script>
  <div id="appCopy">
  </div>
  <script data-pjax>
    var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = 'Â§çÂà∂';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fa fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
            // ËøîÂõûfalse, Èò≤Ê≠¢ÈáçÂ§çËß¶Âèëcopy‰∫ã‰ª∂  
            // return false;
          }
        })
        //  ÁõëÂê¨ ctrl + c‰∫ã‰ª∂  
        // $(document).unbind('keypress').bind('keypress', function (e) {
        //   if (e.ctrlKey && e.keyCode == 67) {
        //     doSomething();
        //     // ËøîÂõûfalse, Èò≤Ê≠¢ÈáçÂ§çËß¶Âèëcopy‰∫ã‰ª∂  
        //     return false;
        //   }
        // })

        // // Èº†Ê†áÂè≥ÈîÆÁöÑÂ§çÂà∂‰∫ã‰ª∂  
        // $(document).unbind('copy').bind('copy', function (e) {
        //   doSomething();
        // });

        function doSomething() {
          that.$notify({
            title: "ÊàêÂäü",
            content: "‰ª£Á†ÅÂ∑≤Â§çÂà∂ÔºåËØ∑ÈÅµÂÆàÁõ∏ÂÖ≥ÊéàÊùÉÂçèËÆÆ„ÄÇ",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })
  </script>


<!-- ÂõæÁâáÊáíÂä†ËΩΩ -->
<script src="/js/lazyload/lazyload@1.9.1.js"></script>
<script data-pjax>
  $(function () {
    $("div.lazyload, img.lazyload, a.lazyload").lazyload(
      {
        effect: "show",
        placeholder: "https://img10.360buyimg.com/ddimg/jfs/t1/159345/8/2271/222193/5ff7b36fEe49f5663/a95287c20385127f.gif"    //ÂõæÁâáÊú™Âä†ËΩΩÂá∫Êù•Êó∂ÊòæÁ§∫ÁöÑÂç†‰ΩçÂõæ
      }
    );
  });
</script>

<!-- Âç°ÁâáÊªöÂä®Âä®Áîª -->
   

<!-- ËØÑËÆ∫ÊâÄÈúÄjs -->

    
        <script type="text/javascript">
    var bamboo = {};
    bamboo.utterance = {};
    
    function check_utterance() {
        let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
        if (isDark) {
            bamboo.utterance.Theme = 'github-dark';
        } else {
            bamboo.utterance.Theme = 'github-light';
        }

        return document.getElementById("gitment-container");
    }
    comment_el = '#gitment-container';
    load_utterance = function () {
        if ($(comment_el).length) {
            // ÂåøÂêçÂáΩÊï∞ÔºåÈò≤Ê≠¢Ê±°ÊüìÂÖ®Â±ÄÂèòÈáè
            const HEAD = check_utterance();
            
            var utterances = document.createElement('script');
            utterances.type = 'text/javascript';
            utterances.async = true;
            utterances.setAttribute('issue-term','pathname')
            utterances.setAttribute('theme', bamboo.utterance.Theme)
            utterances.setAttribute('repo','xingchenxuup/my-utteranc')
            utterances.crossorigin = 'anonymous';
            utterances.src = 'https://utteranc.es/client.js';
            // content ÊòØË¶ÅÊèíÂÖ•ËØÑËÆ∫ÁöÑÂú∞Êñπ
            document.getElementById('gitment-container').appendChild(utterances);
            
        }
    }

    function dark_utterance() {
        const HEAD = check_utterance();
        if (!HEAD) return;
        const message = {
            type: 'set-theme',
            theme: bamboo.utterance.Theme
        };
        const utteranceIframe = document.querySelector('iframe');
        utteranceIframe.contentWindow.postMessage(message, 'https://utteranc.es');
    }

    $(document).ready(load_utterance);
    document.addEventListener('pjax:complete', function () {
        load_utterance();
    });

    $('.dark').click(function() {
        setTimeout(() => {
            dark_utterance();
        });
    })
    
</script>

<style>
    .utterances {
        max-width: inherit!important;
    }
</style>
    


<!-- Èº†Ê†áÁÇπÂáªÁâπÊïà -->
<!-- Áà±ÂøÉÁÇπÂáª -->

	
		<script src="/js/cursor/text.js"></script>
	




    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" data-pjax></script>


    <!-- pjax -->
    

<!-- pjax -->


  <script src="/js/pjax@0.2.8/index.js"></script>
  
    <!-- Ê†∑Âºè‰Ωç‰∫éÔºösource/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <div class="loading-circle"><div id="loader-circle"></div></div>
    <script>
      window.ShowLoading = function() {
        $(".loading-circle").css("display", "block");
      };
      window.HideLoading = function() {
        $(".loading-circle").css("display", "none");
      }
    </script>
  
	<script>
    document.addEventListener('pjax:complete', function () {
      window.HideLoading();
    })
    document.addEventListener('pjax:send', function () {
      window.ShowLoading();
    })
    document.addEventListener('pjax:error', function () {
      window.HideLoading();
    })
	</script>
</div>

  

  <script>
    var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([no-pjax])',   // Êã¶Êà™Ê≠£Â∏∏Â∏¶ÈìæÊé•ÁöÑ a Ê†áÁ≠æ
      selectors: ["#pjax-container","title"],                                   // Ê†πÊçÆÂÆûÈôÖÈúÄË¶ÅÁ°ÆËÆ§ÈáçËΩΩÂå∫Âüü
      cacheBust: false,   // url Âú∞ÂùÄËøΩÂä†Êó∂Èó¥Êà≥ÔºåÁî®‰ª•ÈÅøÂÖçÊµèËßàÂô®ÁºìÂ≠ò
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
    
    // Âà∑Êñ∞‰∏ç‰ªéÈ°∂ÈÉ®ÂºÄÂßã
    document.addEventListener("DOMContentLoaded", function () {
      history.scrollRestoration = 'auto';
    })
  </script>



  </body>
</html>